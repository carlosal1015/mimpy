

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mimpy.mesh.mesh &mdash; mimpy 0.1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="mimpy 0.1.0 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../../../index.html" class="fa fa-home"> mimpy</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../singlephasesection.html">Single-Phase</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../singlephase.html">Single-Phase Derivation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../singlephaseexample.html">Single-Phase Example Walk Through</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../codeoverview.html">Code Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../examplegallery.html">Model Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../twophaseexample1.html">Buckley-Leverett</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../twophaseexample2.html">SPE 10 Layer 85</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#types-of-contributions">Types of Contributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#get-started">Get Started!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#pull-request-guidelines">Pull Request Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing.html#tips">Tips</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">Mimpy Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../meshmodule.html">mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mfdmodule.html">mfd</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modelmodule.html">models</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">mimpy</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>mimpy.mesh.mesh</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for mimpy.mesh.mesh</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot; Mesh module.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">array</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">islice</span>
<span class="kn">import</span> <span class="nn">mimpy.mesh.mesh_cython</span> <span class="kn">as</span> <span class="nn">mesh_cython</span>
<span class="kn">import</span> <span class="nn">mimpy</span> <span class="kn">as</span> <span class="nn">mimpy</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">map</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">range</span>
<span class="kn">from</span> <span class="nn">six.moves</span> <span class="kn">import</span> <span class="nb">zip</span>

<span class="k">def</span> <span class="nf">tb</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Encodes strings for compatibility</span>
<span class="sd">    with Python 3.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">variable_array</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; The class is an efficient reprenstation of variable</span>
<span class="sd">    lenght two dimensional arrays. It can represent</span>
<span class="sd">    basic data types such as ints and floats and allows variable</span>
<span class="sd">    lengths on entries. That is:</span>

<span class="sd">    a[0] = [1, 2, 3, 4,]</span>
<span class="sd">    a[1] = [1, 2, 3, 4, 5, 6, 7]</span>

<span class="sd">    Internally, the data is stored is a 1-d array, with a</span>
<span class="sd">    separate array indicating the offset and data lenth:</span>

<span class="sd">    data = [1, 2, 3, 4, 1, 2, 3, 4, 5, 6, 7]</span>
<span class="sd">    offset = [[0, 4], [5, 7]]</span>

<span class="sd">    The structure allows the user to modify the entries</span>
<span class="sd">    as well as extend the data as needed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dim</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointer_capacity</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_capacity</span>  <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointer_capacity</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                                 <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_capacity</span><span class="p">),</span>
                                 <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_capacity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">),</span>
                                 <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_entries</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointers</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="nf">set_pointer_capacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">capacity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the maximum number of entries in</span>
<span class="sd">        the data structure.</span>

<span class="sd">        :param int capacity: Number of expected entries.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointer_capacity</span> <span class="o">=</span> <span class="n">capacity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointers</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">pointer_capacity</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">refcheck</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_data_capacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">capacity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the maximum number of entries in</span>
<span class="sd">        the data structure.</span>

<span class="sd">        :param int capacity: Total data entries.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_capacity</span> <span class="o">=</span> <span class="n">capacity</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_capacity</span><span class="p">),</span> <span class="n">refcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_capacity</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">),</span> <span class="n">refcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">new_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">minimum</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculates the new size of the array</span>
<span class="sd">        given the old in case there is a need</span>
<span class="sd">        for extending the array.</span>

<span class="sd">        :param int size: Old data size.</span>
<span class="sd">        :param int minimum: Sets minimum new data size.</span>

<span class="sd">        :return: New data structure size.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">size</span><span class="o">+</span><span class="n">size</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">minimum</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds new data to end of the list.</span>

<span class="sd">        :param  dtype data: Generic data to be added. Usually\</span>
<span class="sd">        either scalar type (float, int ...) or ndarray type.</span>

<span class="sd">        :return: Index of the new entry.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_entries</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointers</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pointers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_entries</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pointers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_entries</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_array_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_size</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointers</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pointers</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">new_array_size</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                                 <span class="n">refcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pointers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_entries</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pointers</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_entries</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_size</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)),</span>
                                 <span class="n">refcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">new_size</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">),</span>
                                 <span class="n">refcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_entries</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_entries</span><span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span> <span class="nf">get_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return entry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_entries</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s">&quot;No entry with index &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="p">(</span><span class="n">pos</span><span class="p">,</span>  <span class="n">length</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="n">length</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Overloaded get index function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entry</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Overloaded setting function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_entry</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns number of entries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_entries</span>

    <span class="k">def</span> <span class="nf">set_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Changes existing entry to new data.</span>
<span class="sd">        The new entry can be larger than old, but might cause</span>
<span class="sd">        wasted memory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">length</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointers</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">:</span><span class="n">pos</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pointers</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span><span class="p">:</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_size</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)),</span>
                                     <span class="n">refcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span><span class="p">:</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new_size</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">),</span>
                                     <span class="n">refcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span><span class="p">:</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">pointers</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pointers</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_data_pos</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<div class="viewcode-block" id="Mesh"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh">[docs]</a><span class="k">class</span> <span class="nc">Mesh</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; The **Mesh** class is a common representation of polygonal</span>
<span class="sd">    meshes in Mimpy. In addition to the mesh data structure,</span>
<span class="sd">    it provides commonly used mesh functions as such</span>
<span class="sd">    calculating volumes and centroids as well as basic visualization.</span>
<span class="sd">    The **Mesh** class serves as base implementation,</span>
<span class="sd">    with the specific mesh types (such as hexahedra,</span>
<span class="sd">    tetrahedra and Voronoi) inherting from it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># List of points used to construct mesh faces.</span>
        <span class="c"># Each point coordinate is prepresented by</span>
        <span class="c"># a Numpy array.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_of_points</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># List of mesh faces, each face is represented by the</span>
        <span class="c"># a list of points. In 2D, it&#39;s a list of pairs of poitns.</span>
        <span class="c"># In 3D, it&#39;s an ordered list of points that make up the</span>
        <span class="c"># polygon.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span> <span class="o">=</span> <span class="n">variable_array</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">))</span>

        <span class="c"># Face normals.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">))</span>

        <span class="c"># Area of mesh face.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_areas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">))</span>

        <span class="c"># The centroid of face.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_real_centroids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

        <span class="c"># Dict that maps faces to the cells</span>
        <span class="c"># they are in.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">))</span>

        <span class="c"># A point on the plane of the face that is used</span>
        <span class="c"># to build the MFD matrix R. This point does</span>
        <span class="c"># not have to be on the face itself.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_shifted_centroids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">has_face_shifted_centroid</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_cell_shifted_centroid</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">has_alpha</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">boundary_markers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary_descriptions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Hash from face marker =&gt; [[face index, face normal orientation]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary_faces</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># List of cells. Each cell is made up of a list</span>
        <span class="c"># of faces.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cells</span> <span class="o">=</span> <span class="n">variable_array</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">))</span>

        <span class="c"># For each cell, a list of bools indicating</span>
        <span class="c"># whether the normal in self.face_normals</span>
        <span class="c"># is in or out of the cell.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_normal_orientation</span>  <span class="o">=</span> <span class="n">variable_array</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">))</span>

        <span class="c"># Cell Volumes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_volume</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">))</span>

        <span class="c"># List of cell centroids.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_real_centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">))</span>

        <span class="c"># Points used inside the cell used</span>
        <span class="c"># to build the MFD matrix R.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_shifted_centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cell_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

        <span class="c"># Tags cells depending on which domain</span>
        <span class="c"># they belong to (for fractures and</span>
        <span class="c"># multi-domain problems)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_domain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cell_domain_tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="c"># dict: {face_index: (cell_index, face_orientation), ...}</span>
        <span class="c"># Allows Dirichlet boundaries to be set implicitly</span>
        <span class="c"># based on pressure of cells.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirichlet_boundary_pointers</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">periodic_boundaries</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Faces designated as no flow, meant for</span>
        <span class="c"># interior boundary conditions not to be</span>
        <span class="c"># set by user.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_no_flow</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># dict: {face_index: (lagrange_index, orientation)}</span>
        <span class="c"># Allows dirichlet boundaries to point to</span>
        <span class="c"># lagrange multipliers for domain decomposition.</span>
        <span class="c"># A lagrange multiplier is a face identicial</span>
        <span class="c"># to the one pointing to it, but not associated</span>
        <span class="c"># with any cells.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_to_lagrange_pointers</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># dict: lagrange_index: [(face_index_1, orientation), ...], ...}</span>
        <span class="c"># Points a lagrange multiplier to faces associated</span>
        <span class="c"># with it. Is treated like a forcing function.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lagrange_to_face_pointers</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># dict: {cell_index: [(face_index_1, orientation), ...], ...}</span>
        <span class="c"># Allows source terms to be set implicitly</span>
        <span class="c"># based on fluxes at other faces.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forcing_function_pointers</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c"># Lowest order term coef</span>
        <span class="c"># List: [alpha1, alpha2, ...]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_alpha</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_using_alpha_list</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gravity_vector</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gravity_acceleration</span> <span class="o">=</span> <span class="mf">9.8</span>

<div class="viewcode-block" id="Mesh.add_point"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.add_point">[docs]</a>    <span class="k">def</span> <span class="nf">add_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_point</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Takes a Numpy array</span>
<span class="sd">        representing the cartesian point coodrinates,</span>
<span class="sd">        and appends the point to the end of the point list.</span>
<span class="sd">        Returns the index of the new point.</span>

<span class="sd">        :param ndarray new_point: New point to be added to mesh.</span>
<span class="sd">        :return: Index of new point.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_points</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_points</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_point</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number_of_points</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_array_size</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">new_array_size</span><span class="p">,</span> <span class="n">refcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_points</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_point</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number_of_points</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_points</span><span class="o">-</span><span class="mi">1</span>
</div>
<div class="viewcode-block" id="Mesh.get_point"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_point">[docs]</a>    <span class="k">def</span> <span class="nf">get_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Takes a point index and returns</span>
<span class="sd">        a Numpy array of point coodrinates.</span>

<span class="sd">        :param int point_index:</span>

<span class="sd">        :return: The the point coordinates.</span>
<span class="sd">        :rtype: ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="n">point_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.get_number_of_points"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_number_of_points">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_of_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the total number of points.</span>

<span class="sd">        :return: Total number of points in mesh.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_points</span>
</div>
    <span class="k">def</span> <span class="nf">_memory_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Function for finding size of memory</span>
<span class="sd">        extension jumps.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">size</span><span class="o">+</span><span class="n">size</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span>

<div class="viewcode-block" id="Mesh.add_face"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.add_face">[docs]</a>    <span class="k">def</span> <span class="nf">add_face</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_points</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Takes a list of point indices, and</span>
<span class="sd">        appends them to the list of faces</span>
<span class="sd">        in the mesh. The point indices must</span>
<span class="sd">        be oriented in a clockwise direction</span>
<span class="sd">        relative to the face normal. In 2D, a</span>
<span class="sd">        face is represnted by two points.</span>
<span class="sd">        Returns the index of the new face.</span>

<span class="sd">        :param list list_of_points: List of point indices\</span>
<span class="sd">             making up the new face.</span>

<span class="sd">        :return: Index of new face.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">add_entry</span><span class="p">(</span><span class="n">list_of_points</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_normals</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">new_face_index</span><span class="p">:</span>
            <span class="n">new_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_extension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_normals</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">face_normals</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">new_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">refcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_areas</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">new_face_index</span><span class="p">:</span>
            <span class="n">new_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_extension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_areas</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">face_areas</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">new_size</span><span class="p">,</span> <span class="n">refcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_real_centroids</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">new_face_index</span><span class="p">:</span>
            <span class="n">new_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_extension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_real_centroids</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">face_real_centroids</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">new_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">refcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">new_face_index</span><span class="p">:</span>
            <span class="n">new_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_extension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">new_size</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">new_face_index</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_face_shifted_centroid</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_shifted_centroids</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">new_face_index</span><span class="p">:</span>
                <span class="n">new_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_extension</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_shifted_centroids</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">face_shifted_centroids</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">new_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
                                                   <span class="n">refcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_face_index</span>
</div>
<div class="viewcode-block" id="Mesh.set_face"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_face">[docs]</a>    <span class="k">def</span> <span class="nf">set_face</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets a new set of points for a given face_index.</span>

<span class="sd">        :param int face_index: Face index of face to be set.</span>
<span class="sd">        :param list points: New list of points making up face.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span>
</div>
<div class="viewcode-block" id="Mesh.remove_from_face_to_cell"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.remove_from_face_to_cell">[docs]</a>    <span class="k">def</span> <span class="nf">remove_from_face_to_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Removes the cell_index from face_to_cell map</span>
<span class="sd">        at for face_index.</span>

<span class="sd">        :param int face_index: Face index.</span>
<span class="sd">        :param int cell_index: Cell index.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_index</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">cell_index</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;cell_index &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span><span class="o">+</span>
                            <span class="s">&quot; not found in face_to_cell for &quot;</span><span class="o">+</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Mesh.add_to_face_to_cell"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.add_to_face_to_cell">[docs]</a>    <span class="k">def</span> <span class="nf">add_to_face_to_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds cell_index to face_to_cell map</span>
<span class="sd">        at face_index.</span>

<span class="sd">        :param int face_index: The face index.</span>
<span class="sd">        :param int cell_index: The cell index that will be associated\</span>
<span class="sd">        with the face.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell_index</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell_index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;cell_index &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span><span class="o">+</span>
                            <span class="s">&quot; could not be added to &quot;</span><span class="o">+</span>
                            <span class="nb">str</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Mesh.duplicate_face"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.duplicate_face">[docs]</a>    <span class="k">def</span> <span class="nf">duplicate_face</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates new face with all the properties</span>
<span class="sd">        of the face_index, and adds the face to the</span>
<span class="sd">        bottom of the face list. The function</span>
<span class="sd">        returns the new face index.</span>

<span class="sd">        :param int face_index: Face index to be duplicated.</span>
<span class="sd">        :return: Face index of new duplicated face.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Proper duplication requires duplicating</span>
        <span class="c"># all the properties fo the face.</span>
        <span class="n">new_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_face_area</span><span class="p">(</span><span class="n">new_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_area</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">new_index</span>
</div>
<div class="viewcode-block" id="Mesh.get_face"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_face">[docs]</a>    <span class="k">def</span> <span class="nf">get_face</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Given a face index, returns the</span>
<span class="sd">        list of point indices that make</span>
<span class="sd">        up the face.</span>

<span class="sd">        :param int face_index: Face index.</span>
<span class="sd">        :return: List of points making up face.</span>
<span class="sd">        :rtype: ndarray(&#39;i&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.get_number_of_face_points"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_number_of_face_points">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_of_face_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the number of points that make</span>
<span class="sd">        up a given face.</span>

<span class="sd">        :param int face_index: Face index.</span>
<span class="sd">        :return: Number of point making up the face.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="n">face_index</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Mesh.get_number_of_faces"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_number_of_faces">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_of_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the total number of faces</span>
<span class="sd">        in the mesh. This corresponds to the</span>
<span class="sd">        number of velocity degrees of freedom.</span>

<span class="sd">        :return: Total number of faces in the mesh.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">number_of_entries</span>
</div>
<div class="viewcode-block" id="Mesh.get_number_of_cell_faces"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_number_of_cell_faces">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_of_cell_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the number of faces for cell_index</span>

<span class="sd">        :param int cell_index: Cell index.</span>
<span class="sd">        :return: Number of faces in cell.</span>
<span class="sd">        :rtype: int.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cell_index</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Mesh.get_face_to_cell"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_face_to_cell">[docs]</a>    <span class="k">def</span> <span class="nf">get_face_to_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get list of cells connected with</span>
<span class="sd">        face_index.</span>

<span class="sd">        :param int face_index: Face index.</span>
<span class="sd">        :return: List of cell indices connected to the face.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">f_to_c</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">])</span>
        <span class="n">f_to_c</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">f_to_c</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">f_to_c</span>
</div>
<div class="viewcode-block" id="Mesh.is_line_seg_intersect_face"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.is_line_seg_intersect_face">[docs]</a>    <span class="k">def</span> <span class="nf">is_line_seg_intersect_face</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns True if the line segment</span>
<span class="sd">        intersects with a face.</span>

<span class="sd">        :param int face_index: Face index.</span>
<span class="sd">        :param ndarray p1: Coorindates of first point.</span>
<span class="sd">        :param ndarray p2: Coorindates of second point.</span>
<span class="sd">        :return: True if line segments intersects face.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vector</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span>
        <span class="n">vector</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face_real_centroid</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span> <span class="o">-</span> <span class="n">p1</span><span class="p">),</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">/=</span> <span class="n">denom</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p1</span><span class="o">-</span><span class="n">p2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="n">length</span><span class="o">+</span><span class="mf">1.e-8</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="o">+</span><span class="mf">1.e-8</span><span class="p">:</span>
                <span class="n">intersection_point</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="n">vector</span><span class="o">+</span><span class="n">p1</span>

                <span class="n">direction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">)))</span>

                <span class="n">normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
                <span class="n">current_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">local_index</span><span class="p">,</span> <span class="n">next_point_index</span><span class="p">)</span> <span class="ow">in</span> \
                        <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">)):</span>
                    <span class="n">next_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">next_point_index</span><span class="p">)</span>
                    <span class="n">face_vec</span> <span class="o">=</span> <span class="n">next_point</span> <span class="o">-</span> <span class="n">current_point</span>
                    <span class="n">check_vec</span> <span class="o">=</span> <span class="n">current_point</span> <span class="o">-</span> <span class="n">intersection_point</span>

                    <span class="n">direction</span><span class="p">[</span><span class="n">local_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">face_vec</span><span class="p">,</span>
                                                             <span class="n">check_vec</span><span class="p">),</span>
                                                    <span class="n">normal</span><span class="p">)</span>
                    <span class="n">current_point</span> <span class="o">=</span> <span class="n">next_point</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">direction</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="k">return</span> <span class="bp">True</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">direction</span><span class="o">&lt;</span><span class="mf">0.</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="k">return</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>

</div>
<div class="viewcode-block" id="Mesh.initialize_cells"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.initialize_cells">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number_of_cells</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize cell data structure</span>
<span class="sd">        for known number of cells.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="Mesh.load_mesh"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.load_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">load_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Loads mesh from mms file.</span>

<span class="sd">        :param file intput_file: Mesh file (mms).</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">version</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
        <span class="n">comments</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
        <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
        <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_file</span><span class="p">:</span>
            <span class="n">line_split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;POINTS&quot;</span><span class="p">:</span>
                <span class="n">number_of_points</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number_of_points</span> <span class="o">=</span> <span class="n">number_of_points</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">number_of_points</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;FACES&quot;</span><span class="p">:</span>
                <span class="n">number_of_faces</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">number_of_entries</span> <span class="o">=</span> <span class="n">number_of_faces</span>
                <span class="n">current_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
                <span class="n">n_data_entries</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">current_line</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">n_data_entries</span><span class="p">),</span>
                                             <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">))</span>
                <span class="n">current_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
                <span class="n">n_pointers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">current_line</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">pointers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">n_pointers</span><span class="p">),</span>
                                                 <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;FACE_NORMALS&quot;</span><span class="p">:</span>
                <span class="n">number_of_faces</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">face_normals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span>
                                                      <span class="n">number_of_faces</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;FACE_AREAS&quot;</span><span class="p">:</span>
                <span class="n">number_of_faces</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">face_areas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span>
                                                    <span class="n">number_of_faces</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;FACE_REAL_CENTROIDS&quot;</span><span class="p">:</span>
                <span class="n">number_of_faces</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">face_real_centroids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span>
                                                             <span class="n">number_of_faces</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;FACE_SHIFTED_CENTROIDS&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">has_face_shifted_centroid</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">number_of_faces</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">face_shifted_centroids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
                    <span class="n">islice</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">number_of_faces</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;FACE_TO_CELL&quot;</span><span class="p">:</span>
                <span class="n">number_of_faces</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
                    <span class="n">islice</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">number_of_faces</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;CELLS&quot;</span><span class="p">:</span>
                <span class="n">number_of_cells</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">number_of_entries</span> <span class="o">=</span> <span class="n">number_of_cells</span>
                <span class="n">current_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
                <span class="n">n_data_entries</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">current_line</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">n_data_entries</span><span class="p">),</span>
                                             <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">))</span>

                <span class="n">current_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
                <span class="n">n_pointers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">current_line</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">pointers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">n_pointers</span><span class="p">),</span>
                                                 <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;CELL_NORMAL_ORIENTATION&quot;</span><span class="p">:</span>
                <span class="n">number_of_cells</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_normal_orientation</span><span class="o">.</span><span class="n">number_of_entries</span> <span class="o">=</span> \
                    <span class="n">number_of_cells</span>
                <span class="n">current_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
                <span class="n">n_data_entries</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">current_line</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_normal_orientation</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">n_data_entries</span><span class="p">),</span>
                               <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">))</span>

                <span class="n">current_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
                <span class="n">n_pointers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">current_line</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_normal_orientation</span><span class="o">.</span><span class="n">pointers</span> <span class="o">=</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">n_pointers</span><span class="p">),</span>
                               <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;CELL_VOLUMES&quot;</span><span class="p">:</span>
                <span class="n">number_of_entries</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_volume</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span>
                                                     <span class="n">number_of_entries</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;CELL_REAL_CENTROIDS&quot;</span><span class="p">:</span>
                <span class="n">number_of_entries</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_real_centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span>
                                                            <span class="n">number_of_entries</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;CELL_SHIFTED_CENTROIDS&quot;</span><span class="p">:</span>
                <span class="n">number_of_entries</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_shifted_centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
                    <span class="n">islice</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">number_of_entries</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;CELL_K&quot;</span><span class="p">:</span>
                <span class="n">number_of_cells</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">islice</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">number_of_cells</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;BOUNDARY_MARKERS&quot;</span><span class="p">:</span>
                <span class="n">number_of_boundary_markers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="k">for</span> <span class="n">line_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_boundary_markers</span><span class="p">):</span>
                    <span class="n">current_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
                    <span class="n">line_split</span> <span class="o">=</span> <span class="n">current_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">entries</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line_split</span><span class="p">]</span>
                    <span class="n">boundary_marker</span> <span class="o">=</span> <span class="n">entries</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_boundary_marker</span><span class="p">(</span><span class="n">boundary_marker</span><span class="p">,</span> <span class="s">&quot;FROMFILE&quot;</span><span class="p">)</span>
                    <span class="k">while</span> <span class="n">entries</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_boundary_face</span><span class="p">(</span><span class="n">boundary_marker</span><span class="p">,</span>
                                               <span class="n">entries</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
                                               <span class="n">entries</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;DIRICHLET_BOUNDARY_POINTERS&quot;</span><span class="p">:</span>
                <span class="n">number_of_pointers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">line_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_pointers</span><span class="p">):</span>
                    <span class="n">current_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
                    <span class="n">line_split</span> <span class="o">=</span> <span class="n">current_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">cell_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">orientation</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_dirichlet_face_pointer</span><span class="p">(</span><span class="n">key</span><span class="p">,</span>
                                                    <span class="n">orientation</span><span class="p">,</span>
                                                    <span class="n">cell_index</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;INTERNAL_NO_FLOW&quot;</span><span class="p">:</span>
                <span class="n">number_of_faces</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">line_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_faces</span><span class="p">):</span>
                    <span class="n">current_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
                    <span class="n">line_split</span> <span class="o">=</span> <span class="n">current_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">face_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">orientation</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">internal_no_flow</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">face_index</span><span class="p">,</span> <span class="n">orientation</span><span class="p">])</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;FORCING_FUNCTION_POINTERS&quot;</span><span class="p">:</span>
                <span class="n">number_of_cells</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">line_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_cells</span><span class="p">):</span>
                    <span class="n">current_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
                    <span class="n">line_split</span> <span class="o">=</span> <span class="n">current_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">cell_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">entries</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
                    <span class="n">face_list</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">orientation_list</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">while</span> <span class="n">entries</span><span class="p">:</span>
                        <span class="n">face_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entries</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                        <span class="n">orientation_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entries</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing_pointer</span><span class="p">(</span><span class="n">cell_index</span><span class="p">,</span>
                                             <span class="n">face_list</span><span class="p">,</span>
                                             <span class="n">orientation_list</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;FACE_TO_LAGRANGE_POINTERS&quot;</span><span class="p">:</span>
                <span class="n">number_of_pointers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">line_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_pointers</span><span class="p">):</span>
                    <span class="n">current_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
                    <span class="n">line_split</span> <span class="o">=</span> <span class="n">current_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">face_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">lagrange_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">orientation</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_face_to_lagrange_pointer</span><span class="p">(</span><span class="n">face_index</span><span class="p">,</span>
                                                      <span class="n">orientation</span><span class="p">,</span>
                                                      <span class="n">lagrange_index</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;LAGRANGE_TO_FACE_POINTERS&quot;</span><span class="p">:</span>
                <span class="n">number_of_pointers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">line_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_pointers</span><span class="p">):</span>
                    <span class="n">current_line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
                    <span class="n">line_split</span> <span class="o">=</span> <span class="n">current_line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">lagrange_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">face_index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">orientation</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_lagrange_to_face_pointers</span><span class="p">(</span><span class="n">lagrange_index</span><span class="p">,</span>
                                                       <span class="n">face_index</span><span class="p">,</span>
                                                       <span class="n">orientation</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.save_cell"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.save_cell">[docs]</a>    <span class="k">def</span> <span class="nf">save_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Saves individual cell in mms format.</span>

<span class="sd">        :param int cell_index: Cell index.</span>
<span class="sd">        :param file output_file: File to output cell to.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">glob_to_loc_points</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">temp_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">()</span>

        <span class="n">current_cell</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_cell_orientations</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">face_index</span><span class="p">,</span> <span class="n">orientation</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">),</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_normal_orientation</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)):</span>
            <span class="n">current_face</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">point_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">point_index</span> <span class="ow">in</span> <span class="n">glob_to_loc_points</span><span class="p">:</span>
                    <span class="n">current_face</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">glob_to_loc_points</span><span class="p">[</span><span class="n">point_index</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">current_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">point_index</span><span class="p">)</span>
                    <span class="n">local_index</span> <span class="o">=</span> <span class="n">temp_mesh</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">current_point</span><span class="p">)</span>
                    <span class="n">glob_to_loc_points</span><span class="p">[</span><span class="n">point_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_index</span>
                    <span class="n">current_face</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_index</span><span class="p">)</span>

            <span class="n">new_face_index</span> <span class="o">=</span> <span class="n">temp_mesh</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">current_face</span><span class="p">)</span>
            <span class="n">temp_mesh</span><span class="o">.</span><span class="n">set_face_area</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">get_face_area</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>
            <span class="n">temp_mesh</span><span class="o">.</span><span class="n">set_face_normal</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>
            <span class="n">current_centroid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_real_centroid</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
            <span class="n">temp_mesh</span><span class="o">.</span><span class="n">set_face_real_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">current_centroid</span><span class="p">)</span>
            <span class="n">current_cell</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>
            <span class="n">current_cell_orientations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orientation</span><span class="p">)</span>

        <span class="n">temp_mesh</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="n">current_cell</span><span class="p">,</span> <span class="n">current_cell_orientations</span><span class="p">)</span>
        <span class="n">temp_mesh</span><span class="o">.</span><span class="n">set_cell_k</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_k</span><span class="p">(</span><span class="n">cell_index</span><span class="p">))</span>
        <span class="n">temp_mesh</span><span class="o">.</span><span class="n">set_cell_volume</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_volume</span><span class="p">(</span><span class="n">cell_index</span><span class="p">))</span>
        <span class="n">current_centroid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_real_centroid</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span>
        <span class="n">temp_mesh</span><span class="o">.</span><span class="n">set_cell_real_centroid</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">current_centroid</span><span class="p">)</span>

        <span class="n">temp_mesh</span><span class="o">.</span><span class="n">save_mesh</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.save_mesh"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.save_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">save_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Saves mesh file in mms format.</span>

<span class="sd">        :param file output_file: File to save mesh to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;this is just a test</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">mimpy</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;date</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;name</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;comments</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;#</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;#</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="c">## Points</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;POINTS &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

        <span class="c">## Faces</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;FACES &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">())</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">data</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>  <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%i</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">pointers</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">pointers</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;FACE_NORMALS &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_normals</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_normals</span><span class="p">)</span>

        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;FACE_AREAS &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">())</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">()):</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face_area</span><span class="p">(</span><span class="n">face_index</span><span class="p">)))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>

        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;FACE_REAL_CENTROIDS &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">())</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">()):</span>
            <span class="n">current_centroid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_real_centroid</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">current_centroid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="p">))</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">current_centroid</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="p">))</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">current_centroid</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_face_shifted_centroid</span><span class="p">:</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;FACE_SHIFTED_CENTROIDS &quot;</span><span class="p">)</span>
            <span class="n">output_file</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">())</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">()):</span>
                <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face_real_centroid</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)))</span>

        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;FACE_TO_CELL &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;CELLS &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_cells</span><span class="p">())</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">data</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>  <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%i</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">pointers</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">pointers</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;CELL_NORMAL_ORIENTATION &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_cells</span><span class="p">())</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_normal_orientation</span><span class="o">.</span><span class="n">data</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">cell_normal_orientation</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%i</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_normal_orientation</span><span class="o">.</span><span class="n">pointers</span><span class="p">)))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">cell_normal_orientation</span><span class="o">.</span><span class="n">pointers</span><span class="p">,</span>
                   <span class="n">fmt</span><span class="o">=</span><span class="s">&quot;</span><span class="si">%i</span><span class="s"> </span><span class="si">%i</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;CELL_VOLUMES &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_volume</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_volume</span><span class="p">)</span>

        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;CELL_REAL_CENTROIDS &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_real_centroid</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_real_centroid</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_cell_shifted_centroid</span><span class="p">:</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;CELL_SHIFTED_CENTROIDS &quot;</span><span class="p">)</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_shifted_centroid</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">ouptut_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_shifted_centroid</span><span class="p">)</span>

        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;CELL_K &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_k</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_k</span><span class="p">)</span>

        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;BOUNDARY_MARKERS &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary_markers</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">marker_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_markers</span><span class="p">:</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">marker_index</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">face_index</span><span class="p">,</span> <span class="n">face_orientation</span><span class="p">)</span> <span class="ow">in</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_boundary_faces_by_marker</span><span class="p">(</span><span class="n">marker_index</span><span class="p">):</span>
                <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                    <span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">face_orientation</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="p">))</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;DIRICHLET_BOUNDARY_POINTERS &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">dirichlet_boundary_pointers</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirichlet_boundary_pointers</span><span class="p">:</span>
            <span class="n">cell_index</span><span class="p">,</span> <span class="n">orientation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirichlet_boundary_pointers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">orientation</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>

        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;INTERNAL_NO_FLOW &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">internal_no_flow</span><span class="p">))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="p">[</span><span class="n">face_index</span><span class="p">,</span> <span class="n">orientation</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_no_flow</span><span class="p">:</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">orientation</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>

        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;FORCING_FUNCTION_POINTERS &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forcing_function_pointers</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">cell_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing_function_pointers</span><span class="p">:</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">face_index</span><span class="p">,</span> <span class="n">orientation</span> <span class="ow">in</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">forcing_function_pointers</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]:</span>
                <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">orientation</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="p">))</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;FACE_TO_LAGRANGE_POINTERS &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_to_lagrange_pointers</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_lagrange_pointers</span><span class="p">:</span>
            <span class="n">lagrange_index</span><span class="p">,</span> <span class="n">orientation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_lagrange_pointers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">lagrange_index</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">orientation</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>

        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s">&quot;LAGRANGE_TO_FACE_POINTERS &quot;</span><span class="p">)</span>
        <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lagrange_to_face_pointers</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lagrange_to_face_pointers</span><span class="p">:</span>
            <span class="n">face_index</span><span class="p">,</span> <span class="n">orientation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lagrange_to_face_pointers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">tb</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">orientation</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">))</span>

        <span class="n">output_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Mesh.set_cell_faces"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_cell_faces">[docs]</a>    <span class="k">def</span> <span class="nf">set_cell_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">,</span> <span class="n">faces</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the cell faces.</span>

<span class="sd">        :param int cell_index: Cell index.</span>
<span class="sd">        :param list faces: Faces making up cell.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">faces</span>
        <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">faces</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cell_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_to_face_to_cell</span><span class="p">(</span><span class="n">face_index</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.set_cell_orientation"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_cell_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">set_cell_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">,</span> <span class="n">orientation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the cell orientation of faces.</span>

<span class="sd">        :param int cell_index: Cell index.</span>
<span class="sd">        :paramt list orientation: List of new cell face orientations.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_normal_orientation</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">orientation</span>
</div>
<div class="viewcode-block" id="Mesh.add_cell"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.add_cell">[docs]</a>    <span class="k">def</span> <span class="nf">add_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">list_of_faces</span><span class="p">,</span>
                 <span class="n">list_of_orientations</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds a new cell to the mesh. A cell is represented</span>
<span class="sd">        by a list of face indices. The function also</span>
<span class="sd">        takes in a list of orientations of the same length</span>
<span class="sd">        as the list_of_faces. These represent the direction</span>
<span class="sd">        of the face normals relative to the cell: (1) points in,</span>
<span class="sd">        (-1) points out.</span>
<span class="sd">        Returns the index of the new cell.</span>

<span class="sd">        :param list list_of_faces: List of face indices making up new cell.</span>
<span class="sd">        :param list list_of_orientations: List consisting of 1s and -1s\</span>
<span class="sd">            indicating whether normals are pointing out (1) or in (-1) of cell.</span>

<span class="sd">        :return: New cell index.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_cell_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">add_entry</span><span class="p">(</span><span class="n">list_of_faces</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_normal_orientation</span><span class="o">.</span><span class="n">add_entry</span><span class="p">(</span><span class="n">list_of_orientations</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_volume</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">&lt;</span><span class="n">new_cell_index</span><span class="p">:</span>
            <span class="n">new_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_extension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_volume</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell_volume</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">new_size</span><span class="p">,</span> <span class="n">refcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_k</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">&lt;</span><span class="n">new_cell_index</span><span class="p">:</span>
            <span class="n">new_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_extension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_k</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell_k</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">new_size</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">refcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">list_of_faces</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_cell_index</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_cell_index</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;setting face &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; to cell &quot;</span><span class="o">+</span>
                                <span class="nb">str</span><span class="p">(</span><span class="n">new_cell_index</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; already set&quot;</span><span class="o">+</span>
                                <span class="s">&quot; to two cells &quot;</span><span class="o">+</span>
                                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">]))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_domain</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">&lt;</span><span class="n">new_cell_index</span><span class="p">:</span>
            <span class="n">new_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_extension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_domain</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell_domain</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">new_size</span><span class="p">,</span> <span class="n">refcheck</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_real_centroid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">&lt;</span><span class="n">new_cell_index</span><span class="p">:</span>
            <span class="n">new_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_extension</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_real_centroid</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell_real_centroid</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">new_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_alpha</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell_alpha</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_shifted_centroid</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_cell_shifted_centroid</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_shifted_centroid</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">&lt;</span><span class="n">new_cell_index</span><span class="p">:</span>
                <span class="n">new_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_memory_extension</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_shifted_centroid</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cell_shifted_centroid</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">new_size</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">new_cell_index</span>
</div>
<div class="viewcode-block" id="Mesh.get_cell"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_cell">[docs]</a>    <span class="k">def</span> <span class="nf">get_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Given a cell_index, it returns the list of faces</span>
<span class="sd">        that make up that cell.</span>

<span class="sd">        :param int cell_index: Cell index of interest.</span>
<span class="sd">        :return: List of faces making up cell.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.get_cell_normal_orientation"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_cell_normal_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">get_cell_normal_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Given a cell index, returns a list of face</span>
<span class="sd">        orientations for that cell.</span>

<span class="sd">        :param int cell_index: Index of cell.</span>
<span class="sd">        :return: List of faces orientations in cell. The\</span>
<span class="sd">        list is made up of 1s and -1s, 1 if the corresponding\</span>
<span class="sd">        face normal is pointing out of the cell, and -1 if the\</span>
<span class="sd">        corresponding face normal is pointing into the cell.</span>

<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_normal_orientation</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.get_number_of_cells"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_number_of_cells">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_of_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns total number of cells in mesh.</span>

<span class="sd">        :return: Number of cells in mesh.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.set_cell_real_centroid"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_cell_real_centroid">[docs]</a>    <span class="k">def</span> <span class="nf">set_cell_real_centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">,</span> <span class="n">centroid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the array of the cell centroid.</span>

<span class="sd">        :param int cell_index: Index of cell.</span>
<span class="sd">        :param ndarray centroid: New cell centroid.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_real_centroid</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">centroid</span>
</div>
<div class="viewcode-block" id="Mesh.get_cell_real_centroid"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_cell_real_centroid">[docs]</a>    <span class="k">def</span> <span class="nf">get_cell_real_centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns array of the cell centroid</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_real_centroid</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.get_all_cell_real_centroids"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_all_cell_real_centroids">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_cell_real_centroids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns list of all cell centroids.</span>

<span class="sd">        :return: List of all the cell centroids.</span>
<span class="sd">        :rtype: ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_real_centroid</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_cells</span><span class="p">()]</span>
</div>
<div class="viewcode-block" id="Mesh.get_all_cell_shifted_centroids"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_all_cell_shifted_centroids">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_cell_shifted_centroids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns list of all cell centroids.</span>

<span class="sd">        :return: List of all shifted cell centroid.</span>
<span class="sd">        :rtype: ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_shifted_centroid</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_cells</span><span class="p">()]</span>
</div>
<div class="viewcode-block" id="Mesh.set_cell_shifted_centroid"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_cell_shifted_centroid">[docs]</a>    <span class="k">def</span> <span class="nf">set_cell_shifted_centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">,</span> <span class="n">centroid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the shifted centroid for cell_index.</span>

<span class="sd">        :param int cell_index: Index of cell.</span>
<span class="sd">        :param ndarray centroid: Shifted centroid point.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_shifted_centroid</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">centroid</span>
</div>
<div class="viewcode-block" id="Mesh.use_face_shifted_centroid"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.use_face_shifted_centroid">[docs]</a>    <span class="k">def</span> <span class="nf">use_face_shifted_centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets whether a shifted face centroid will be used</span>
<span class="sd">        for mesh.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_face_shifted_centroid</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Mesh.is_using_face_shifted_centroid"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.is_using_face_shifted_centroid">[docs]</a>    <span class="k">def</span> <span class="nf">is_using_face_shifted_centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns if shifted face centroids are used</span>
<span class="sd">        and set in mesh.</span>

<span class="sd">        :return: Whether face shifted centroids are set</span>
<span class="sd">        and used.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_face_shifted_centroid</span>
</div>
<div class="viewcode-block" id="Mesh.use_cell_shifted_centroid"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.use_cell_shifted_centroid">[docs]</a>    <span class="k">def</span> <span class="nf">use_cell_shifted_centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets whether a shifted cell centroid will be used</span>
<span class="sd">        for mesh.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_cell_shifted_centroid</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Mesh.is_using_cell_shifted_centroid"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.is_using_cell_shifted_centroid">[docs]</a>    <span class="k">def</span> <span class="nf">is_using_cell_shifted_centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns if shifted face centroids are used</span>
<span class="sd">        and set in mesh.</span>

<span class="sd">        :return: Whether cell shifted centroids are set</span>
<span class="sd">        and used.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_cell_shifted_centroid</span>
</div>
<div class="viewcode-block" id="Mesh.get_cell_shifted_centroid"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_cell_shifted_centroid">[docs]</a>    <span class="k">def</span> <span class="nf">get_cell_shifted_centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the shifted cell centroid for cell_index.</span>

<span class="sd">        :param int cell_index: Index of cell.</span>
<span class="sd">        :return: Cell shifted point.</span>
<span class="sd">        :rtype: ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_shifted_centroid</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.set_cell_volume"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_cell_volume">[docs]</a>    <span class="k">def</span> <span class="nf">set_cell_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">,</span> <span class="n">volume</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets cell volume for cell_index.</span>

<span class="sd">        :param int cell_index: Index of cell.</span>
<span class="sd">        :param float volume: New volume to be set for cell.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_volume</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span>  <span class="o">=</span> <span class="n">volume</span>
</div>
<div class="viewcode-block" id="Mesh.get_cell_volume"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_cell_volume">[docs]</a>    <span class="k">def</span> <span class="nf">get_cell_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns cell volume for cell_index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_volume</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.set_cell_k"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_cell_k">[docs]</a>    <span class="k">def</span> <span class="nf">set_cell_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set cell permeability tensor K</span>
<span class="sd">        (Numpy matrix) for cell_index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_k</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Mesh.get_cell_k"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_cell_k">[docs]</a>    <span class="k">def</span> <span class="nf">get_cell_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return permeability tensor k</span>
<span class="sd">        (Numpy matrix) for cell_index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_k</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Mesh.get_all_k_entry"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_all_k_entry">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_k_entry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a list of all K[i, j].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_k</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_cells</span><span class="p">(),</span> <span class="n">i</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="n">j</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.get_all_k"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_all_k">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_k</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a list of all cell</span>
<span class="sd">        permeability tensors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_k</span>
</div>
<div class="viewcode-block" id="Mesh.use_alpha"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.use_alpha">[docs]</a>    <span class="k">def</span> <span class="nf">use_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Activates the ability to set the</span>
<span class="sd">        alpha parameter for each cell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_alpha</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Mesh.set_alpha_by_cell"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_alpha_by_cell">[docs]</a>    <span class="k">def</span> <span class="nf">set_alpha_by_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set alpha (float) for cell_index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_alpha</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span>
</div>
<div class="viewcode-block" id="Mesh.get_alpha_by_cell"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_alpha_by_cell">[docs]</a>    <span class="k">def</span> <span class="nf">get_alpha_by_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns alpha (float) for cell_index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_alpha</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.set_face_real_centroid"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_face_real_centroid">[docs]</a>    <span class="k">def</span> <span class="nf">set_face_real_centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">,</span> <span class="n">centroid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets face centroid for face_index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_real_centroids</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">centroid</span>
</div>
<div class="viewcode-block" id="Mesh.get_face_real_centroid"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_face_real_centroid">[docs]</a>    <span class="k">def</span> <span class="nf">get_face_real_centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns face centroid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_real_centroids</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.set_face_shifted_centroid"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_face_shifted_centroid">[docs]</a>    <span class="k">def</span> <span class="nf">set_face_shifted_centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">,</span> <span class="n">centroid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets face shifted centroid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_shifted_centroids</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">centroid</span>
</div>
<div class="viewcode-block" id="Mesh.get_face_shifted_centroid"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_face_shifted_centroid">[docs]</a>    <span class="k">def</span> <span class="nf">get_face_shifted_centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return face shifted centroid coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_shifted_centroids</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.set_face_area"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_face_area">[docs]</a>    <span class="k">def</span> <span class="nf">set_face_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">,</span> <span class="n">area</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets face area (float) for face_index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_areas</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">area</span>
</div>
<div class="viewcode-block" id="Mesh.get_face_area"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_face_area">[docs]</a>    <span class="k">def</span> <span class="nf">get_face_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return area of face.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_areas</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.set_face_normal"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_face_normal">[docs]</a>    <span class="k">def</span> <span class="nf">set_face_normal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">,</span> <span class="n">normal</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set face normal (array) to face_index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_normals</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">normal</span>
</div>
<div class="viewcode-block" id="Mesh.get_face_normal"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_face_normal">[docs]</a>    <span class="k">def</span> <span class="nf">get_face_normal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return face normal for face_index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_normals</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.set_boundary_markers"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_boundary_markers">[docs]</a>    <span class="k">def</span> <span class="nf">set_boundary_markers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary_markers</span><span class="p">,</span> <span class="n">boundary_descriptions</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initialize the mesh boundary labeling. Each marker</span>
<span class="sd">        can represent a single boundary face or a group</span>
<span class="sd">        of faces.</span>

<span class="sd">        boundary_markers: List of integers.</span>
<span class="sd">        boundary_descriptions: List of strings describing</span>
<span class="sd">        the face groups.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary_markers</span> <span class="o">=</span> <span class="n">boundary_markers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary_descriptions</span> <span class="o">=</span> <span class="n">boundary_descriptions</span>

        <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">boundary_markers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">boundary_faces</span><span class="p">[</span><span class="n">marker</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="Mesh.add_boundary_marker"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.add_boundary_marker">[docs]</a>    <span class="k">def</span> <span class="nf">add_boundary_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary_marker</span><span class="p">,</span> <span class="n">boundary_description</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a new boundary marker.</span>

<span class="sd">        :param int boundary_marker: New boundary marker index.</span>
<span class="sd">        :param str boundary_description: Text describing</span>
<span class="sd">             the boundary marker.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary_markers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">boundary_marker</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary_descriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">boundary_description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary_faces</span><span class="p">[</span><span class="n">boundary_marker</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="Mesh.create_new_boundary_marker"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.create_new_boundary_marker">[docs]</a>    <span class="k">def</span> <span class="nf">create_new_boundary_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary_description</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates new boundary marker and assures</span>
<span class="sd">        that the index is unique. Returns the</span>
<span class="sd">        index of the new boundary marker.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary_markers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary_markers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary_descriptions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">boundary_description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary_faces</span><span class="p">[</span><span class="n">new_index</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">new_index</span>
</div>
<div class="viewcode-block" id="Mesh.has_boundary_marker"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.has_boundary_marker">[docs]</a>    <span class="k">def</span> <span class="nf">has_boundary_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary_marker</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns true if boundary_marker exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">boundary_marker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_markers</span>
</div>
<div class="viewcode-block" id="Mesh.get_boundary_markers"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_boundary_markers">[docs]</a>    <span class="k">def</span> <span class="nf">get_boundary_markers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a list of all boundary markers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_markers</span>
</div>
<div class="viewcode-block" id="Mesh.get_boundary_description"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_boundary_description">[docs]</a>    <span class="k">def</span> <span class="nf">get_boundary_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary_marker</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the boundary description for</span>
<span class="sd">        boundary_marker.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_descriptions</span><span class="p">[</span><span class="n">boundary_marker</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.add_boundary_face"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.add_boundary_face">[docs]</a>    <span class="k">def</span> <span class="nf">add_boundary_face</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">boundary_marker</span><span class="p">,</span>
                          <span class="n">face_index</span><span class="p">,</span>
                          <span class="n">face_orientation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Assign face_index to a certain boundary_marker grouping.</span>
<span class="sd">        the face_orientation indicates whether the normal of that</span>
<span class="sd">        face points in (-1) or out (1) of the cell the face</span>
<span class="sd">        belongs to.</span>

<span class="sd">        A face should never be associated with more than one marker.</span>

<span class="sd">        :param int boundary_marker: Boundary marker index.</span>
<span class="sd">        :param int face_index: Index of face.</span>
<span class="sd">        :param  int face_orientation: Orientation of face normal\</span>
<span class="sd">             relative to the domain. (1) if pointing out, (-1) if\</span>
<span class="sd">             if pointing in.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary_faces</span><span class="p">[</span><span class="n">boundary_marker</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">face_index</span><span class="p">,</span>
                                                     <span class="n">face_orientation</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Mesh.set_boundary_faces"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_boundary_faces">[docs]</a>    <span class="k">def</span> <span class="nf">set_boundary_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">boundary_marker</span><span class="p">,</span>
                           <span class="n">face_orientation_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Takes a boundary_marker index, and sets the entire list</span>
<span class="sd">        of tuples for that boundary marker.</span>

<span class="sd">        :param int boundary_marker: Boundary marker to be set.</span>
<span class="sd">        :param list face_orienation_list: A list of tuples of the form\</span>
<span class="sd">             [face_index, orientation] to be associated with the\</span>
<span class="sd">             indicated boundary marker.</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary_faces</span><span class="p">[</span><span class="n">boundary_marker</span><span class="p">]</span> <span class="o">=</span> <span class="n">face_orientation_list</span>
</div>
<div class="viewcode-block" id="Mesh.get_boundary_faces_by_marker"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_boundary_faces_by_marker">[docs]</a>    <span class="k">def</span> <span class="nf">get_boundary_faces_by_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundary_marker</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a list of all the faces associated with a boundary_marker.</span>

<span class="sd">        :param int boundary_marker: Boundary marker index.</span>

<span class="sd">        :return: List of tupes [face_index, orientation] associated with\</span>
<span class="sd">             boundary_marker.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_faces</span><span class="p">[</span><span class="n">boundary_marker</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.is_boundary_face"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.is_boundary_face">[docs]</a>    <span class="k">def</span> <span class="nf">is_boundary_face</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">,</span> <span class="n">markers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns True if face_index belongs to</span>
<span class="sd">        any of the markers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">boundary_marker</span> <span class="ow">in</span> <span class="n">markers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_faces</span><span class="p">[</span><span class="n">boundary_marker</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">face_index</span> <span class="o">==</span> <span class="n">face</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="Mesh.find_boundary_marker"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.find_boundary_marker">[docs]</a>    <span class="k">def</span> <span class="nf">find_boundary_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">,</span> <span class="n">markers</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the boundary marker containing</span>
<span class="sd">        face_index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">boundary_marker</span> <span class="ow">in</span> <span class="n">markers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_faces</span><span class="p">[</span><span class="n">boundary_marker</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">face_index</span> <span class="o">==</span> <span class="n">face</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="n">boundary_marker</span>
</div>
<div class="viewcode-block" id="Mesh.set_boundary_face_orientation"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_boundary_face_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">set_boundary_face_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">,</span> <span class="n">new_orientation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set orientation for face_index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">bm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_markers</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_faces</span><span class="p">[</span><span class="n">bm</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">face_index</span> <span class="o">==</span> <span class="n">face</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">face</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_orientation</span>
</div>
<div class="viewcode-block" id="Mesh.get_number_of_boundary_faces"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_number_of_boundary_faces">[docs]</a>    <span class="k">def</span> <span class="nf">get_number_of_boundary_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns number of faces on the boundary</span>
<span class="sd">        of the domain.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">number_of_boundary_faces</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">boundary_marker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_markers</span><span class="p">:</span>
            <span class="n">number_of_boundary_faces</span> <span class="o">+=</span> \
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary_faces</span><span class="p">[</span><span class="n">boundary_marker</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">number_of_boundary_faces</span>
</div>
<div class="viewcode-block" id="Mesh.add_internal_no_flow"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.add_internal_no_flow">[docs]</a>    <span class="k">def</span> <span class="nf">add_internal_no_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">,</span> <span class="n">face_orientation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets face as interior no flow boundary condition.</span>

<span class="sd">        :param int face_index: Face index to be set as internal no-flow.</span>
<span class="sd">        :param int face_orientation: Orientation of face relative to the\</span>
<span class="sd">        domain, (1) for pointing out, (-1) for pointing in.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal_no_flow</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">face_index</span><span class="p">,</span> <span class="n">face_orientation</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Mesh.get_internal_no_flow"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_internal_no_flow">[docs]</a>    <span class="k">def</span> <span class="nf">get_internal_no_flow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns list of faces set as</span>
<span class="sd">        internal no flow condition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_no_flow</span>
</div>
<div class="viewcode-block" id="Mesh.set_dirichlet_face_pointer"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_dirichlet_face_pointer">[docs]</a>    <span class="k">def</span> <span class="nf">set_dirichlet_face_pointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                   <span class="n">face_index</span><span class="p">,</span>
                                   <span class="n">face_orientation</span><span class="p">,</span>
                                   <span class="n">cell_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the value of a Dirichlet boundary to</span>
<span class="sd">        value of cell pressure for cell_index.</span>
<span class="sd">        This approach is used for coupling fractures</span>
<span class="sd">        with a reservoir.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># The function adds a zero entry to the</span>
        <span class="c"># dirichlet_boundary_values dict. This</span>
        <span class="c"># allows the MFD code to build the matrix</span>
        <span class="c"># correctly, and doesn&#39;t effect the right-hand</span>
        <span class="c"># side of the problem.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirichlet_boundary_pointers</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">(</span><span class="n">cell_index</span><span class="p">,</span> <span class="n">face_orientation</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.get_dirichlet_pointer_faces"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_dirichlet_pointer_faces">[docs]</a>    <span class="k">def</span> <span class="nf">get_dirichlet_pointer_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns all the faces with Dirichlet</span>
<span class="sd">        values set by pointing to a cell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirichlet_boundary_pointers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="Mesh.set_face_to_lagrange_pointer"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_face_to_lagrange_pointer">[docs]</a>    <span class="k">def</span> <span class="nf">set_face_to_lagrange_pointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                     <span class="n">face_index</span><span class="p">,</span>
                                     <span class="n">face_orientation</span><span class="p">,</span>
                                     <span class="n">lagrange_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets face to dirichlet type boundary pointing to</span>
<span class="sd">        lagrange multiplier.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># The function adds a zero entry to the</span>
        <span class="c"># dirichlet_boundary_values dict. This</span>
        <span class="c"># allows the MFD code to build the matrix</span>
        <span class="c"># correctly, and doesn&#39;t effect the right-hand</span>
        <span class="c"># side of the problem.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">face_to_lagrange_pointers</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span> <span class="o">=</span> \
            <span class="p">(</span><span class="n">lagrange_index</span><span class="p">,</span> <span class="n">face_orientation</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.get_all_face_to_lagrange_pointers"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_all_face_to_lagrange_pointers">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_face_to_lagrange_pointers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns all face indices that are</span>
<span class="sd">        pointing to a lagrange multiplier.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">face_to_lagrange_pointers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="Mesh.get_face_to_lagrange_pointer"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_face_to_lagrange_pointer">[docs]</a>    <span class="k">def</span> <span class="nf">get_face_to_lagrange_pointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the lagrange multiplier index</span>
<span class="sd">        and the face normal orientation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_lagrange_pointers</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.set_lagrange_to_face_pointers"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_lagrange_to_face_pointers">[docs]</a>    <span class="k">def</span> <span class="nf">set_lagrange_to_face_pointers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="n">lagrange_index</span><span class="p">,</span>
                                      <span class="n">face_index</span><span class="p">,</span>
                                      <span class="n">orientation</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the lagrange multiplier to the source faces</span>
<span class="sd">        in order to impose zero flux across the boundary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lagrange_to_face_pointers</span><span class="p">[</span><span class="n">lagrange_index</span><span class="p">]</span> <span class="o">=</span> \
            <span class="nb">zip</span><span class="p">(</span><span class="n">face_index</span><span class="p">,</span> <span class="n">orientation</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.get_all_lagrange_to_face_pointers"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_all_lagrange_to_face_pointers">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_lagrange_to_face_pointers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns all lagrange face indices that</span>
<span class="sd">        point to fluxes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lagrange_to_face_pointers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="Mesh.get_lagrange_to_face_pointers"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_lagrange_to_face_pointers">[docs]</a>    <span class="k">def</span> <span class="nf">get_lagrange_to_face_pointers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lagrange_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the faces the lagrange_index face</span>
<span class="sd">        points too.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lagrange_to_face_pointers</span><span class="p">[</span><span class="n">lagrange_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.get_dirichlet_pointer"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_dirichlet_pointer">[docs]</a>    <span class="k">def</span> <span class="nf">get_dirichlet_pointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the cell_index for</span>
<span class="sd">        which the Dirichlet boundary will be set</span>
<span class="sd">        implicitly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirichlet_boundary_pointers</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.set_periodic_boundary"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_periodic_boundary">[docs]</a>    <span class="k">def</span> <span class="nf">set_periodic_boundary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">face_index_1</span><span class="p">,</span>
                              <span class="n">face_orientation_1</span><span class="p">,</span>
                              <span class="n">face_index_2</span><span class="p">,</span>
                              <span class="n">face_orientation_2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets a periodic boundary condition, connecting</span>
<span class="sd">        face 1 with face 2. This ammounts to creating a single</span>
<span class="sd">        lagrange multiplier shared by the faces. The MFD class would</span>
<span class="sd">        impose continuity of both the pressure and the flux</span>
<span class="sd">        for the periodic conditions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lagrange_index_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duplicate_face</span><span class="p">(</span><span class="n">face_index_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodic_boundaries</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">face_index_1</span><span class="p">,</span>
                                         <span class="n">face_orientation_1</span><span class="p">,</span>
                                         <span class="n">face_index_2</span><span class="p">,</span>
                                         <span class="n">face_orientation_2</span><span class="p">,</span>
                                         <span class="n">lagrange_index_1</span><span class="p">,))</span>
</div>
<div class="viewcode-block" id="Mesh.set_forcing_pointer"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_forcing_pointer">[docs]</a>    <span class="k">def</span> <span class="nf">set_forcing_pointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">cell_index</span><span class="p">,</span>
                            <span class="n">face_indices</span><span class="p">,</span>
                            <span class="n">face_orientations</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the value of the forcing function</span>
<span class="sd">        implicity as the sum of the fluxes from list</span>
<span class="sd">        of faces. This approach is used for coupling</span>
<span class="sd">        fractures with a reservoir.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># The function adds a zero entry to the</span>
        <span class="c"># cell_forcing_function dict. This</span>
        <span class="c"># allows the MFD code to build the matrix</span>
        <span class="c"># correctly, and doesn&#39;t effect the right-hand</span>
        <span class="c"># side of the problem.</span>
        <span class="c"># If the forcing function is set later on</span>
        <span class="c"># (in case of well for example), it</span>
        <span class="c"># becomes additive to the source term</span>
        <span class="c"># for that cell.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forcing_function_pointers</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span> <span class="o">=</span> \
            <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">face_indices</span><span class="p">,</span> <span class="n">face_orientations</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Mesh.get_forcing_pointer_cells"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_forcing_pointer_cells">[docs]</a>    <span class="k">def</span> <span class="nf">get_forcing_pointer_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns cell indices with forcing function</span>
<span class="sd">        pointers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forcing_function_pointers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="Mesh.get_forcing_pointers_for_cell"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_forcing_pointers_for_cell">[docs]</a>    <span class="k">def</span> <span class="nf">get_forcing_pointers_for_cell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns list of pointers (face_indices)</span>
<span class="sd">        for cell_index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcing_function_pointers</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.set_cell_domain"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_cell_domain">[docs]</a>    <span class="k">def</span> <span class="nf">set_cell_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets cell domain identifier</span>
<span class="sd">        for cell_index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_domain</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">domain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell_domain_tags</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.get_domain_tags"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_domain_tags">[docs]</a>    <span class="k">def</span> <span class="nf">get_domain_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns list of all domain tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell_domain_tags</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.get_cell_domain"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_cell_domain">[docs]</a>    <span class="k">def</span> <span class="nf">get_cell_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns cell domain identifier</span>
<span class="sd">        for cell_index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_domain</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Mesh.get_cell_domain_all"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_cell_domain_all">[docs]</a>    <span class="k">def</span> <span class="nf">get_cell_domain_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns list containing</span>
<span class="sd">        all cell_domain tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_domain</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_cells</span><span class="p">()]</span>
</div>
<div class="viewcode-block" id="Mesh.get_cells_in_domain"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_cells_in_domain">[docs]</a>    <span class="k">def</span> <span class="nf">get_cells_in_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns all cells with domain tag.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cells_in_domain</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cell_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_cells</span><span class="p">()):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cell_domain</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span> <span class="o">==</span> <span class="n">domain</span><span class="p">:</span>
                <span class="n">cells_in_domain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cells_in_domain</span>
</div>
<div class="viewcode-block" id="Mesh.set_gravity_vector"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.set_gravity_vector">[docs]</a>    <span class="k">def</span> <span class="nf">set_gravity_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gravity_vector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set vector indicating gravity acceleration direction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gravity_vector</span> <span class="o">=</span> <span class="n">gravity_vector</span>
</div>
<div class="viewcode-block" id="Mesh.get_gravity_vector"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_gravity_vector">[docs]</a>    <span class="k">def</span> <span class="nf">get_gravity_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns gravity vector (down direction)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gravity_vector</span>
</div>
<div class="viewcode-block" id="Mesh.get_gravity_acceleration"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.get_gravity_acceleration">[docs]</a>    <span class="k">def</span> <span class="nf">get_gravity_acceleration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the gravity acceleration constant.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gravity_acceleration</span>
</div>
<div class="viewcode-block" id="Mesh.find_basis_for_face"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.find_basis_for_face">[docs]</a>    <span class="k">def</span> <span class="nf">find_basis_for_face</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Finds two non collinear vectors</span>
<span class="sd">        in face to serve as basis for plane.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">face</span><span class="p">)):</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">face</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">face</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">face</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">face</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">v2</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
            <span class="n">v1</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>
            <span class="k">if</span> <span class="mf">1.</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">v1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v2</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.e-6</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">face</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t compute basis for face &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Mesh.find_face_normal"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.find_face_normal">[docs]</a>    <span class="k">def</span> <span class="nf">find_face_normal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Finds the face normal based on</span>
<span class="sd">        rotation around the face boundary.</span>
<span class="sd">        Assumes the face is planar.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">face</span><span class="p">)):</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">face</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">face</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">face</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">face</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">new_face_normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">new_face_normal</span><span class="p">)</span> <span class="o">&gt;</span><span class="mf">1.e-10</span><span class="p">:</span>
                <span class="n">new_face_normal</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">new_face_normal</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">new_face_normal</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t compute normal for face &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Mesh.find_centroid_for_coordinates"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.find_centroid_for_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">find_centroid_for_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Computes centroid calculation for a 3D polygon based on</span>
<span class="sd">        two coordinates of the polygon.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">C_1</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">C_2</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">area</span>  <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">index_1</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">index_2</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">current_face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current_face</span><span class="p">)):</span>
            <span class="n">current_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">current_face</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_face</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">next_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">current_face</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">next_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">current_face</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">C_1</span> <span class="o">+=</span> <span class="p">((</span><span class="n">current_point</span><span class="p">[</span><span class="n">index_1</span><span class="p">]</span><span class="o">+</span><span class="n">next_point</span><span class="p">[</span><span class="n">index_1</span><span class="p">])</span><span class="o">*</span>
                    <span class="p">(</span><span class="n">current_point</span><span class="p">[</span><span class="n">index_1</span><span class="p">]</span><span class="o">*</span><span class="n">next_point</span><span class="p">[</span><span class="n">index_2</span><span class="p">]</span><span class="o">-</span>
                     <span class="n">next_point</span><span class="p">[</span><span class="n">index_1</span><span class="p">]</span><span class="o">*</span><span class="n">current_point</span><span class="p">[</span><span class="n">index_2</span><span class="p">]))</span>

            <span class="n">C_2</span> <span class="o">+=</span> <span class="p">((</span><span class="n">current_point</span><span class="p">[</span><span class="n">index_2</span><span class="p">]</span><span class="o">+</span><span class="n">next_point</span><span class="p">[</span><span class="n">index_2</span><span class="p">])</span><span class="o">*</span>
                    <span class="p">(</span><span class="n">current_point</span><span class="p">[</span><span class="n">index_1</span><span class="p">]</span><span class="o">*</span><span class="n">next_point</span><span class="p">[</span><span class="n">index_2</span><span class="p">]</span><span class="o">-</span>
                     <span class="n">next_point</span><span class="p">[</span><span class="n">index_1</span><span class="p">]</span><span class="o">*</span><span class="n">current_point</span><span class="p">[</span><span class="n">index_2</span><span class="p">]))</span>

            <span class="n">area</span> <span class="o">+=</span> <span class="n">current_point</span><span class="p">[</span><span class="n">index_1</span><span class="p">]</span><span class="o">*</span><span class="n">next_point</span><span class="p">[</span><span class="n">index_2</span><span class="p">]</span>
            <span class="n">area</span> <span class="o">-=</span> <span class="n">next_point</span><span class="p">[</span><span class="n">index_1</span><span class="p">]</span><span class="o">*</span><span class="n">current_point</span><span class="p">[</span><span class="n">index_2</span><span class="p">]</span>

        <span class="n">area</span> <span class="o">/=</span> <span class="mf">2.</span>
        <span class="n">C_1</span> <span class="o">/=</span> <span class="mf">6.</span><span class="o">*</span><span class="n">area</span>
        <span class="n">C_2</span> <span class="o">/=</span> <span class="mf">6.</span><span class="o">*</span><span class="n">area</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">C_1</span><span class="p">,</span> <span class="n">C_2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.find_face_centroid"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.find_face_centroid">[docs]</a>    <span class="k">def</span> <span class="nf">find_face_centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns centroid coordinates for face_index.</span>
<span class="sd">        This function assumes planarity of the face.</span>
<span class="sd">        and is currently intended for use with three dimensional</span>
<span class="sd">        meshes.</span>
<span class="sd">        The function returns the area of the face, as well</span>
<span class="sd">        as the x, y, z coordinates of its center.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">origin_index</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_basis_for_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
        <span class="n">polygon</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                   <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">)]</span>

        <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span> <span class="o">&gt;</span><span class="mf">1.e-12</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="o">&gt;</span><span class="mf">1.e-12</span><span class="p">)</span>

        <span class="n">v1</span> <span class="o">=</span> <span class="n">v1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span>

        <span class="n">v_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v_temp</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span><span class="o">&lt;</span> <span class="mf">1.e-10</span><span class="p">:</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">polygon</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">v_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v_temp</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span>

        <span class="n">v2</span> <span class="o">=</span> <span class="n">v2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>

        <span class="n">origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">origin_index</span><span class="p">)</span>

        <span class="n">transposed_polygon</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">-</span> <span class="n">origin</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">]</span>
        <span class="n">polygon_projected_v1</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">transposed_polygon</span><span class="p">]</span>
        <span class="n">polygon_projected_v2</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">v2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">transposed_polygon</span><span class="p">]</span>
        <span class="n">polygon_projected</span> <span class="o">=</span>  <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">polygon_projected_v1</span><span class="p">,</span>
                                 <span class="n">polygon_projected_v2</span><span class="p">))</span>

        <span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_polygon_area</span><span class="p">(</span><span class="n">polygon_projected</span><span class="p">)</span>

        <span class="n">centroid_x</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">centroid_y</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygon_projected</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">centroid_x</span> <span class="o">+=</span> <span class="p">((</span><span class="n">polygon_projected</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span>
                            <span class="n">polygon_projected</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span>
                           <span class="p">(</span><span class="n">polygon_projected</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span>
                            <span class="n">polygon_projected</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span>
                            <span class="n">polygon_projected</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span>
                            <span class="n">polygon_projected</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>

            <span class="n">centroid_y</span> <span class="o">+=</span> <span class="p">((</span><span class="n">polygon_projected</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span>
                            <span class="n">polygon_projected</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span>
                           <span class="p">(</span><span class="n">polygon_projected</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span>
                            <span class="n">polygon_projected</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span>
                            <span class="n">polygon_projected</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span>
                            <span class="n">polygon_projected</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">centroid_x</span> <span class="o">+=</span> <span class="p">((</span><span class="n">polygon_projected</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span>
                        <span class="n">polygon_projected</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span>
                       <span class="p">(</span><span class="n">polygon_projected</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span>
                        <span class="n">polygon_projected</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span>
                        <span class="n">polygon_projected</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span>
                        <span class="n">polygon_projected</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">centroid_y</span> <span class="o">+=</span> <span class="p">((</span><span class="n">polygon_projected</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span>
                        <span class="n">polygon_projected</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span>
                       <span class="p">(</span><span class="n">polygon_projected</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span>
                        <span class="n">polygon_projected</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span>
                        <span class="n">polygon_projected</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span>
                        <span class="n">polygon_projected</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>

        <span class="n">centroid_x</span> <span class="o">=</span> <span class="n">centroid_x</span><span class="o">/</span><span class="p">(</span><span class="mf">6.</span><span class="o">*</span><span class="n">area</span><span class="p">)</span>
        <span class="n">centroid_y</span> <span class="o">=</span> <span class="n">centroid_y</span><span class="o">/</span><span class="p">(</span><span class="mf">6.</span><span class="o">*</span><span class="n">area</span><span class="p">)</span>

        <span class="n">centroid_3d_x</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">centroid_3d_y</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">centroid_3d_z</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="n">centroid_3d_x</span> <span class="o">+=</span> <span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">centroid_3d_y</span> <span class="o">+=</span> <span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">centroid_3d_z</span> <span class="o">+=</span> <span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">centroid_3d_x</span> <span class="o">+=</span> <span class="n">centroid_x</span> <span class="o">*</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">centroid_3d_y</span> <span class="o">+=</span> <span class="n">centroid_x</span> <span class="o">*</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">centroid_3d_z</span> <span class="o">+=</span> <span class="n">centroid_x</span> <span class="o">*</span> <span class="n">v1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">centroid_3d_x</span> <span class="o">+=</span> <span class="n">centroid_y</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">centroid_3d_y</span> <span class="o">+=</span> <span class="n">centroid_y</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">centroid_3d_z</span> <span class="o">+=</span> <span class="n">centroid_y</span> <span class="o">*</span> <span class="n">v2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">centroid_3d_x</span><span class="p">,</span> <span class="n">centroid_3d_y</span><span class="p">,</span> <span class="n">centroid_3d_z</span><span class="p">])</span>

        <span class="k">return</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">area</span><span class="p">),</span> <span class="n">centroid</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.compute_polygon_area"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.compute_polygon_area">[docs]</a>    <span class="k">def</span> <span class="nf">compute_polygon_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polygon</span><span class="p">,</span> <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot; Computes the area of a polygon. A polygon is</span>
<span class="sd">        represented by a list of Numpy array coordinates</span>
<span class="sd">        going around the polygon. The optional parameter</span>
<span class="sd">        *dims* represents which two coordinates to use</span>
<span class="sd">        when the polygon is in 3D space.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_x</span> <span class="o">=</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">current_y</span> <span class="o">=</span> <span class="n">dims</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">area</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">area</span> <span class="o">+=</span> <span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">current_x</span><span class="p">]</span><span class="o">*</span><span class="n">polygon</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">current_y</span><span class="p">]</span><span class="o">-</span>
                     <span class="n">polygon</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">current_x</span><span class="p">]</span><span class="o">*</span><span class="n">polygon</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">current_y</span><span class="p">])</span>

        <span class="n">area</span> <span class="o">+=</span> <span class="p">(</span><span class="n">polygon</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">current_x</span><span class="p">]</span><span class="o">*</span><span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">current_y</span><span class="p">]</span><span class="o">-</span>
                 <span class="n">polygon</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">current_x</span><span class="p">]</span><span class="o">*</span><span class="n">polygon</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">current_y</span><span class="p">])</span>

        <span class="n">area</span> <span class="o">*=</span> <span class="o">.</span><span class="mi">5</span>
        <span class="c"># The function returns the absolute value of the area.</span>
        <span class="k">return</span> <span class="n">area</span>
</div>
<div class="viewcode-block" id="Mesh.find_volume_centroid_all"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.find_volume_centroid_all">[docs]</a>    <span class="k">def</span> <span class="nf">find_volume_centroid_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Computes the cell centroids and volumes</span>
<span class="sd">        for all the cells in the mesh.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">## This is based on the code and</span>
        <span class="c">## paper by Brian Mirtich.</span>
        <span class="n">zero3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cell_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_cells</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_volume</span><span class="p">(</span><span class="n">cell_index</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_real_centroid</span><span class="p">(</span><span class="n">cell_index</span><span class="p">,</span> <span class="n">zero3</span><span class="p">)</span>

        <span class="n">mesh_cython</span><span class="o">.</span><span class="n">all_cell_volumes_centroids</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">pointers</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell_normal_orientation</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell_volume</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell_real_centroid</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">pointers</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">face_normals</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.find_volume_from_faces"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.find_volume_from_faces">[docs]</a>    <span class="k">def</span> <span class="nf">find_volume_from_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">face_list</span><span class="p">,</span> <span class="n">orientation_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculates volume and centroid of cell</span>
<span class="sd">        based on list of faces and face orientations relative</span>
<span class="sd">        to the cell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">volume</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">face_index</span><span class="p">,</span> <span class="n">face_orientation</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">face_list</span><span class="p">,</span> <span class="n">orientation_list</span><span class="p">):</span>
            <span class="n">current_normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span><span class="o">*</span><span class="n">face_orientation</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">current_normal</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">current_normal</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">current_normal</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">abs</span><span class="p">(</span><span class="n">current_normal</span><span class="p">[</span><span class="mi">2</span><span class="p">])):</span>
                <span class="n">C</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">current_normal</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">&gt;</span><span class="nb">abs</span><span class="p">(</span><span class="n">current_normal</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                <span class="n">C</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">C</span> <span class="o">=</span> <span class="mi">2</span>

            <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span>
            <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">A</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span>

            <span class="n">P1</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">Pa</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">Pb</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">Paa</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">Pab</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">Pbb</span> <span class="o">=</span> <span class="mf">0.</span>

            <span class="k">if</span> <span class="n">face_orientation</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
                <span class="n">next_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">points</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">next_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
                <span class="n">points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">next_points</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">next_points</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">point_index</span><span class="p">,</span> <span class="n">next_point_index</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">next_points</span><span class="p">):</span>
                <span class="n">a0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">point_index</span><span class="p">)[</span><span class="n">A</span><span class="p">]</span>
                <span class="n">b0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">point_index</span><span class="p">)[</span><span class="n">B</span><span class="p">]</span>
                <span class="n">a1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">next_point_index</span><span class="p">)[</span><span class="n">A</span><span class="p">]</span>
                <span class="n">b1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">next_point_index</span><span class="p">)[</span><span class="n">B</span><span class="p">]</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">a1</span><span class="o">-</span><span class="n">a0</span>
                <span class="n">db</span> <span class="o">=</span> <span class="n">b1</span><span class="o">-</span><span class="n">b0</span>
                <span class="n">a0_2</span> <span class="o">=</span> <span class="n">a0</span><span class="o">*</span><span class="n">a0</span>
                <span class="n">a0_3</span> <span class="o">=</span> <span class="n">a0_2</span><span class="o">*</span><span class="n">a0</span>
                <span class="n">b0_2</span> <span class="o">=</span> <span class="n">b0</span><span class="o">*</span><span class="n">b0</span>
                <span class="n">b0_3</span> <span class="o">=</span> <span class="n">b0_2</span><span class="o">*</span><span class="n">b0</span>
                <span class="n">a1_2</span> <span class="o">=</span> <span class="n">a1</span><span class="o">*</span><span class="n">a1</span>
                <span class="n">C1</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">+</span> <span class="n">a0</span>
                <span class="n">Ca</span> <span class="o">=</span> <span class="n">a1</span><span class="o">*</span><span class="n">C1</span> <span class="o">+</span> <span class="n">a0_2</span>
                <span class="n">Caa</span> <span class="o">=</span> <span class="n">a1</span><span class="o">*</span><span class="n">Ca</span> <span class="o">+</span> <span class="n">a0_3</span>
                <span class="n">Cb</span> <span class="o">=</span> <span class="n">b1</span><span class="o">*</span><span class="p">(</span><span class="n">b1</span> <span class="o">+</span> <span class="n">b0</span><span class="p">)</span> <span class="o">+</span> <span class="n">b0_2</span>
                <span class="n">Cbb</span> <span class="o">=</span> <span class="n">b1</span><span class="o">*</span><span class="n">Cb</span> <span class="o">+</span> <span class="n">b0_3</span>
                <span class="n">Cab</span> <span class="o">=</span> <span class="mf">3.</span><span class="o">*</span><span class="n">a1_2</span> <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a0</span> <span class="o">+</span> <span class="n">a0_2</span>
                <span class="n">Kab</span> <span class="o">=</span> <span class="n">a1_2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">a1</span><span class="o">*</span><span class="n">a0</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">a0_2</span>

                <span class="n">P1</span> <span class="o">+=</span> <span class="n">db</span><span class="o">*</span><span class="n">C1</span>
                <span class="n">Pa</span> <span class="o">+=</span> <span class="n">db</span><span class="o">*</span><span class="n">Ca</span>
                <span class="n">Paa</span> <span class="o">+=</span> <span class="n">db</span><span class="o">*</span><span class="n">Caa</span>
                <span class="n">Pb</span> <span class="o">+=</span> <span class="n">da</span><span class="o">*</span><span class="n">Cb</span>
                <span class="n">Pbb</span> <span class="o">+=</span> <span class="n">da</span><span class="o">*</span><span class="n">Cbb</span>
                <span class="n">Pab</span> <span class="o">+=</span> <span class="n">db</span><span class="o">*</span><span class="p">(</span><span class="n">b1</span><span class="o">*</span><span class="n">Cab</span> <span class="o">+</span> <span class="n">b0</span><span class="o">*</span><span class="n">Kab</span><span class="p">)</span>

            <span class="n">P1</span> <span class="o">/=</span> <span class="mf">2.0</span>
            <span class="n">Pa</span> <span class="o">/=</span> <span class="mf">6.0</span>
            <span class="n">Paa</span> <span class="o">/=</span> <span class="mf">12.0</span>
            <span class="n">Pb</span> <span class="o">/=</span> <span class="o">-</span><span class="mf">6.0</span>
            <span class="n">Pbb</span> <span class="o">/=</span> <span class="o">-</span><span class="mf">12.0</span>
            <span class="n">Pab</span> <span class="o">/=</span> <span class="mf">24.0</span>

            <span class="n">first_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="n">current_normal</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">first_point</span><span class="p">)</span>
            <span class="n">k1</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">current_normal</span><span class="p">[</span><span class="n">C</span><span class="p">]</span>
            <span class="n">k2</span> <span class="o">=</span> <span class="n">k1</span><span class="o">*</span><span class="n">k1</span>
            <span class="n">k3</span> <span class="o">=</span> <span class="n">k2</span><span class="o">*</span><span class="n">k1</span>

            <span class="n">Fa</span> <span class="o">=</span> <span class="n">k1</span><span class="o">*</span><span class="n">Pa</span>
            <span class="n">Fb</span> <span class="o">=</span> <span class="n">k1</span><span class="o">*</span><span class="n">Pb</span>
            <span class="n">Fc</span> <span class="o">=</span> <span class="o">-</span><span class="n">k2</span><span class="o">*</span><span class="p">(</span><span class="n">current_normal</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">*</span><span class="n">Pa</span> <span class="o">+</span> <span class="n">current_normal</span><span class="p">[</span><span class="n">B</span><span class="p">]</span><span class="o">*</span><span class="n">Pb</span> <span class="o">+</span> <span class="n">w</span><span class="o">*</span><span class="n">P1</span><span class="p">)</span>

            <span class="n">Faa</span> <span class="o">=</span> <span class="n">k1</span><span class="o">*</span><span class="n">Paa</span>
            <span class="n">Fbb</span> <span class="o">=</span> <span class="n">k1</span><span class="o">*</span><span class="n">Pbb</span>
            <span class="n">Fcc</span> <span class="o">=</span> <span class="n">k3</span><span class="o">*</span><span class="p">((</span><span class="n">current_normal</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">*</span><span class="n">current_normal</span><span class="p">[</span><span class="n">A</span><span class="p">])</span><span class="o">*</span><span class="n">Paa</span><span class="o">+</span>
                      <span class="mi">2</span><span class="o">*</span><span class="n">current_normal</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">*</span><span class="n">current_normal</span><span class="p">[</span><span class="n">B</span><span class="p">]</span><span class="o">*</span><span class="n">Pab</span><span class="o">+</span>
                      <span class="p">(</span><span class="n">current_normal</span><span class="p">[</span><span class="n">B</span><span class="p">]</span><span class="o">*</span><span class="n">current_normal</span><span class="p">[</span><span class="n">B</span><span class="p">])</span><span class="o">*</span><span class="n">Pbb</span><span class="o">+</span>
                      <span class="n">w</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">current_normal</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">*</span><span class="n">Pa</span><span class="o">+</span><span class="n">current_normal</span><span class="p">[</span><span class="n">B</span><span class="p">]</span><span class="o">*</span><span class="n">Pb</span><span class="p">)</span><span class="o">+</span><span class="n">w</span><span class="o">*</span><span class="n">P1</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">A</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">volume</span> <span class="o">+=</span> <span class="n">current_normal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Fa</span>
            <span class="k">elif</span> <span class="n">B</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">volume</span> <span class="o">+=</span> <span class="n">current_normal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Fb</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">volume</span> <span class="o">+=</span> <span class="n">current_normal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Fc</span>

            <span class="n">centroid</span><span class="p">[</span><span class="n">A</span><span class="p">]</span> <span class="o">+=</span> <span class="n">current_normal</span><span class="p">[</span><span class="n">A</span><span class="p">]</span><span class="o">*</span><span class="n">Faa</span>
            <span class="n">centroid</span><span class="p">[</span><span class="n">B</span><span class="p">]</span> <span class="o">+=</span> <span class="n">current_normal</span><span class="p">[</span><span class="n">B</span><span class="p">]</span><span class="o">*</span><span class="n">Fbb</span>
            <span class="n">centroid</span><span class="p">[</span><span class="n">C</span><span class="p">]</span> <span class="o">+=</span> <span class="n">current_normal</span><span class="p">[</span><span class="n">C</span><span class="p">]</span><span class="o">*</span><span class="n">Fcc</span>

        <span class="n">centroid</span> <span class="o">/=</span> <span class="n">volume</span><span class="o">*</span><span class="mf">2.</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.find_volume_centroid"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.find_volume_centroid">[docs]</a>    <span class="k">def</span> <span class="nf">find_volume_centroid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the volume and centroid for a 3D cell_index.</span>
<span class="sd">        Based on code and paper by Brian Mirtich.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">face_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span>
        <span class="n">orientation_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_normal_orientation</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_volume_from_faces</span><span class="p">(</span><span class="n">face_list</span><span class="p">,</span> <span class="n">orientation_list</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.output_vector_field"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.output_vector_field">[docs]</a>    <span class="k">def</span> <span class="nf">output_vector_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">file_name</span><span class="p">,</span>
                            <span class="n">vector_magnitudes</span> <span class="o">=</span> <span class="p">[],</span>
                            <span class="n">vector_labels</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; Outputs vector data in the vtk format. The vector</span>
<span class="sd">        field can be processed using the glyph filter in</span>
<span class="sd">        Paraview. The function takes a list of vector</span>
<span class="sd">        magnitudes that are associated with each face</span>
<span class="sd">        normal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span> <span class="o">+</span><span class="s">&quot;.vtk&quot;</span><span class="p">,</span><span class="s">&#39;wb&#39;</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot;# vtk DataFile Version 1.0&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;MFD output&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;ASCII&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;DATASET UNSTRUCTURED_GRID&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;POINTS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">()</span> <span class="p">,</span>  <span class="s">&quot;float&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">()):</span>
            <span class="n">current_point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_real_centroid</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">current_point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">current_point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">current_point</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;CELLS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">()):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="n">face_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;CELL_TYPES&quot;</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">(),</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">()):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;POINT_DATA&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_faces</span><span class="p">(),</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">data_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vector_labels</span><span class="p">)):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;VECTORS&quot;</span><span class="p">,</span> <span class="n">vector_labels</span><span class="p">[</span><span class="n">data_index</span><span class="p">],</span> <span class="s">&quot;float&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vector_magnitudes</span><span class="p">[</span><span class="n">data_index</span><span class="p">])):</span>
                <span class="n">current_vector</span> <span class="o">=</span> <span class="n">vector_magnitudes</span><span class="p">[</span><span class="n">data_index</span><span class="p">][</span><span class="n">face_index</span><span class="p">]</span><span class="o">*</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>

                <span class="k">print</span><span class="p">(</span><span class="n">current_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">current_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">current_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

            <span class="k">print</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.output_cell_normals"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.output_cell_normals">[docs]</a>    <span class="k">def</span> <span class="nf">output_cell_normals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Outputs the normals over the cell in the outward direction.</span>
<span class="sd">        The function is intended for checking the correct orientation of cell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span> <span class="o">+</span><span class="s">&quot;.vtk&quot;</span><span class="p">,</span><span class="s">&#39;wb&#39;</span><span class="p">)</span>

        <span class="n">number_of_faces</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">))</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot;# vtk DataFile Version 1.0&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;MFD output&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;ASCII&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;DATASET UNSTRUCTURED_GRID&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;POINTS&quot;</span><span class="p">,</span> <span class="n">number_of_faces</span> <span class="p">,</span>  <span class="s">&quot;float&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">):</span>
            <span class="n">centroid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_real_centroid</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">centroid</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">centroid</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">centroid</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;CELLS&quot;</span><span class="p">,</span> <span class="n">number_of_faces</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">number_of_faces</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_of_faces</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;1&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;POINT_DATA&quot;</span><span class="p">,</span> <span class="n">number_of_faces</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot;VECTORS&quot;</span><span class="p">,</span> <span class="s">&quot;OUT_NORMAL&quot;</span><span class="p">,</span> <span class="s">&quot;float&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="n">face_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span>
        <span class="n">orientation_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_normal_orientation</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">face_index</span><span class="p">,</span> <span class="n">orientation</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">face_list</span><span class="p">,</span> <span class="n">orientation_list</span><span class="p">):</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">normal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">orientation</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">normal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">orientation</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">normal</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">orientation</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.output_vtk_faces"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.output_vtk_faces">[docs]</a>    <span class="k">def</span> <span class="nf">output_vtk_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">file_name</span><span class="p">,</span>
                         <span class="n">face_indices</span><span class="p">,</span>
                         <span class="n">face_values</span> <span class="o">=</span> <span class="p">[],</span>
                         <span class="n">face_value_labels</span> <span class="o">=</span> <span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; Outputs in vtk format the faces in face_indices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span> <span class="o">+</span><span class="s">&quot;.vtk&quot;</span><span class="p">,</span><span class="s">&#39;wt&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;# vtk DataFile Version 2.0&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;# unstructured mesh&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;ASCII&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;DATASET UNSTRUCTURED_GRID&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;POINTS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_points</span><span class="p">(),</span> <span class="s">&quot;float&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">point_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_points</span><span class="p">()):</span>
            <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">point_index</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="n">total_polygon_points</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">face_indices</span><span class="p">:</span>
            <span class="n">total_polygon_points</span> <span class="o">+=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_face_points</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot;CELLS&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">face_indices</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">total_polygon_points</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">face_indices</span><span class="p">:</span>
            <span class="n">current_face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current_face</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">current_face</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot;CELL_TYPES&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">face_indices</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">face_indices</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">face_values</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;CELL_DATA&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">face_indices</span><span class="p">),</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">entryname</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">face_values</span><span class="p">,</span> <span class="n">face_value_labels</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;SCALARS&quot;</span><span class="p">,</span> <span class="n">entryname</span><span class="p">,</span> <span class="s">&quot;double 1&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;LOOKUP_TABLE default&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Mesh.output_vtk_mesh"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.output_vtk_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">output_vtk_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">file_name</span><span class="p">,</span>
                        <span class="n">cell_values</span><span class="o">=</span><span class="p">[],</span>
                        <span class="n">cell_value_labels</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; Base implementation for producing</span>
<span class="sd">        vtk files for general polyhedral meshes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span> <span class="o">+</span><span class="s">&quot;.vtk&quot;</span><span class="p">,</span><span class="s">&#39;wb&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;# vtk DataFile Version 2.0&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;# unstructured mesh&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;ASCII&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;DATASET UNSTRUCTURED_GRID&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;POINTS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_points</span><span class="p">(),</span> <span class="s">&quot;float&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">point_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_points</span><span class="p">()):</span>
            <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">point_index</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="n">total_polygon_points</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">cell_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_cells</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">):</span>
                <span class="n">total_polygon_points</span> <span class="o">+=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_face_points</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">total_polygon_points</span> <span class="o">+=</span> <span class="mi">2</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot;CELLS&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_cells</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">total_polygon_points</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">cell_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_cells</span><span class="p">()):</span>
            <span class="n">number_of_entries</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">):</span>
                <span class="n">number_of_entries</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_face_points</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
            <span class="n">number_of_entries</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">print</span><span class="p">(</span><span class="n">number_of_entries</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">):</span>
                <span class="n">current_face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current_face</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">current_face</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">print</span><span class="p">(</span><span class="s">&quot;CELL_TYPES&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_cells</span><span class="p">(),</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cell_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_cells</span><span class="p">()):</span>
            <span class="k">print</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cell_values</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;CELL_DATA&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_cells</span><span class="p">(),</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">entryname</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">cell_values</span><span class="p">,</span> <span class="n">cell_value_labels</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;SCALARS&quot;</span><span class="p">,</span> <span class="n">entryname</span><span class="p">,</span> <span class="s">&quot;double 1&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;LOOKUP_TABLE default&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">output</span><span class="p">)</span>

        <span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Mesh.find_cell_near_point"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.find_cell_near_point">[docs]</a>    <span class="k">def</span> <span class="nf">find_cell_near_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">condition</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns cell whose centroid is closest</span>
<span class="sd">        to a given point. Condition is an optional function</span>
<span class="sd">        to avoid cells with certain conditions (e.g. too small).</span>
<span class="sd">        Condition takes in cell_index.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">closest_cell</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">min_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cell_real_centroid</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">point</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">cell_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_number_of_cells</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">condition</span><span class="p">(</span><span class="n">cell_index</span><span class="p">):</span>
                <span class="n">cell_centroid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_real_centroid</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span>
                <span class="n">new_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">cell_centroid</span><span class="o">-</span><span class="n">point</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">new_distance</span> <span class="o">&lt;</span> <span class="n">min_distance</span><span class="p">:</span>
                    <span class="n">closest_cell</span> <span class="o">=</span> <span class="n">cell_index</span>
                    <span class="n">min_distance</span> <span class="o">=</span> <span class="n">new_distance</span>

        <span class="k">return</span> <span class="n">closest_cell</span>
</div>
<div class="viewcode-block" id="Mesh.subdivide_by_domain"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.subdivide_by_domain">[docs]</a>    <span class="k">def</span> <span class="nf">subdivide_by_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cells</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Takes a collection of cells, and</span>
<span class="sd">        seperates them from the rest of the domain</span>
<span class="sd">        using lagrange multipliers at the sub-domain</span>
<span class="sd">        boundary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lagrange_faces</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cell_index</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">):</span>
                <span class="n">neighboring_cells</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighboring_cells</span><span class="p">)</span><span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">cell1</span><span class="p">,</span> <span class="n">cell2</span> <span class="o">=</span> <span class="n">neighboring_cells</span>
                    <span class="k">if</span> <span class="n">cell1</span> <span class="o">==</span> <span class="n">cell_index</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cell2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span>
                            <span class="n">lagrange_faces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">cell2</span> <span class="o">==</span> <span class="n">cell_index</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cell1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span>
                            <span class="n">lagrange_faces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">lagrange_faces</span><span class="p">:</span>
            <span class="p">(</span><span class="n">cell1</span><span class="p">,</span> <span class="n">cell2</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cell1</span> <span class="ow">in</span> <span class="n">cells</span><span class="p">:</span>
                <span class="n">other_cell</span> <span class="o">=</span> <span class="n">cell2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">other_cell</span> <span class="o">=</span> <span class="n">cell1</span>

            <span class="n">new_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>
            <span class="n">lagrange_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_normal</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_normal</span><span class="p">(</span><span class="n">lagrange_face_index</span><span class="p">,</span>
                                 <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_real_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">get_face_real_centroid</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_real_centroid</span><span class="p">(</span><span class="n">lagrange_face_index</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">get_face_real_centroid</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_area</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">get_face_area</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_area</span><span class="p">(</span><span class="n">lagrange_face_index</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">get_face_area</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_boundary_face</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">new_face_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_boundary_face</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">face_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">faces_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">other_cell</span><span class="p">))</span>
            <span class="n">local_face_index_in_other</span> <span class="o">=</span> <span class="n">faces_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>

            <span class="n">new_cell_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">other_cell</span><span class="p">)</span>
            <span class="n">new_cell_faces</span><span class="p">[</span><span class="n">local_face_index_in_other</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_face_index</span>
</div>
<div class="viewcode-block" id="Mesh.find_domain_faces"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.find_domain_faces">[docs]</a>    <span class="k">def</span> <span class="nf">find_domain_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Identifies the faces on the boundary</span>
<span class="sd">        of the domain.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">boundary_faces</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">boundary_orientation</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cell_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cells_in_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">):</span>
            <span class="n">cell_cell_normal</span> <span class="o">=</span> \
                <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_normal_orientation</span><span class="p">(</span><span class="n">cell_index</span><span class="p">))</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">face_index</span><span class="p">,</span> <span class="n">orientation</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cell_cell_normal</span><span class="p">:</span>
                <span class="n">neighboring_cells</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">neighboring_cells</span><span class="p">)</span><span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">cell1</span><span class="p">,</span> <span class="n">cell2</span> <span class="o">=</span> <span class="n">neighboring_cells</span>
                    <span class="k">if</span> <span class="n">cell1</span> <span class="o">==</span> <span class="n">cell_index</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cell2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cells_in_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">):</span>
                            <span class="n">boundary_faces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
                            <span class="n">boundary_orientation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orientation</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">cell2</span> <span class="o">==</span> <span class="n">cell_index</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">cell1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cells_in_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">):</span>
                            <span class="n">boundary_faces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
                            <span class="n">boundary_orientation</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orientation</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">boundary_faces</span><span class="p">,</span> <span class="n">boundary_orientation</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.construct_polygon_from_segs"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.construct_polygon_from_segs">[docs]</a>    <span class="k">def</span> <span class="nf">construct_polygon_from_segs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segments</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Takes point pairs and constructs a single polygon</span>
<span class="sd">        from joining all the ends. The pairs are identified</span>
<span class="sd">        by directly comparing the point locations.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">## Start by setting the first point.</span>
        <span class="n">current_segments</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>

        <span class="n">new_face</span> <span class="o">=</span> <span class="p">[</span><span class="n">current_segments</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">point_to_match</span> <span class="o">=</span> <span class="n">current_segments</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">current_segments</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">current_segments</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">to_be_removed</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">hits</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">segment</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">current_segments</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">point_to_match</span><span class="p">)</span><span class="o">-</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="mf">1.e-7</span><span class="p">:</span>
                    <span class="n">new_face</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">to_be_removed</span> <span class="o">=</span> <span class="n">index</span>
                    <span class="n">next_point_to_match</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">hits</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">point_to_match</span><span class="p">)</span><span class="o">-</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="mf">1.e-7</span><span class="p">:</span>
                    <span class="n">new_face</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">to_be_removed</span> <span class="o">=</span> <span class="n">index</span>
                    <span class="n">next_point_to_match</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">hits</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">assert</span><span class="p">(</span><span class="n">hits</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">current_segments</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Faild at constructing polygon from segments&quot;</span><span class="p">)</span>

            <span class="n">current_segments</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">to_be_removed</span><span class="p">)</span>
            <span class="n">point_to_match</span> <span class="o">=</span> <span class="n">next_point_to_match</span>

        <span class="k">return</span> <span class="n">new_face</span>
</div>
<div class="viewcode-block" id="Mesh.divide_cell_by_plane"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.divide_cell_by_plane">[docs]</a>    <span class="k">def</span> <span class="nf">divide_cell_by_plane</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">,</span> <span class="n">point_on_plane</span><span class="p">,</span> <span class="n">plane_normal</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Divides given cell into two cells</span>
<span class="sd">        based on a plane specified by a point on the plane</span>
<span class="sd">        and the plane normal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span>
        <span class="n">interior_face_segments</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">face_segments_to_be_added</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">current_cell</span><span class="p">:</span>
            <span class="n">face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>

            <span class="n">new_face_1</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">new_face_2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">face_offset</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">face</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">+</span> <span class="p">[</span><span class="n">face</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">intersection_switch</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">point_index</span><span class="p">,</span> <span class="n">next_point_index</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">face</span><span class="p">,</span> <span class="n">face_offset</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">intersection_switch</span><span class="p">:</span>
                    <span class="n">new_face_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point_index</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_face_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point_index</span><span class="p">)</span>

                <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">point_index</span><span class="p">)</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">next_point_index</span><span class="p">)</span>

                <span class="n">vector</span> <span class="o">=</span> <span class="n">p2</span> <span class="o">-</span> <span class="n">p1</span>
                <span class="n">vector</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>

                <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">((</span><span class="n">point_on_plane</span> <span class="o">-</span> <span class="n">p1</span><span class="p">),</span> <span class="n">plane_normal</span><span class="p">)</span>
                <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">plane_normal</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">/=</span> <span class="n">denom</span>
                    <span class="n">length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p1</span><span class="o">-</span><span class="n">p2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;=</span> <span class="n">length</span><span class="o">+</span><span class="mf">1.e-8</span> <span class="ow">and</span>  <span class="n">d</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="o">-</span><span class="mf">1.e-8</span><span class="p">:</span>
                        <span class="n">new_point_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">d</span><span class="o">*</span><span class="n">vector</span><span class="o">+</span><span class="n">p1</span><span class="p">)</span>
                        <span class="n">new_face_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_point_index</span><span class="p">)</span>
                        <span class="n">new_face_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_point_index</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">intersection_switch</span><span class="p">:</span>
                            <span class="n">interior_face_segments</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">new_point_index</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">interior_face_segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_point_index</span><span class="p">)</span>
                        <span class="n">intersection_switch</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">intersection_switch</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_face_2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">,</span> <span class="n">new_face_1</span><span class="p">)</span>

                <span class="k">assert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_face_1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">)</span>
                <span class="p">(</span><span class="n">face_1_area</span><span class="p">,</span>
                 <span class="n">face_1_centroid</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_face_centroid</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_face_real_centroid</span><span class="p">(</span><span class="n">face_index</span><span class="p">,</span> <span class="n">face_1_centroid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_face_area</span><span class="p">(</span><span class="n">face_index</span><span class="p">,</span> <span class="n">face_1_area</span><span class="p">)</span>

                <span class="n">new_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">new_face_2</span><span class="p">)</span>

                <span class="p">(</span><span class="n">face_area</span><span class="p">,</span>
                 <span class="n">face_centroid</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_face_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_face_real_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">face_centroid</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_face_area</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">face_area</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">set_face_normal</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>

                <span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_faces</span><span class="p">(</span><span class="n">cell_index</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">faces</span><span class="p">)</span><span class="o">+</span><span class="p">[</span><span class="n">new_face_index</span><span class="p">])</span>

                <span class="n">cell_orientations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_normal_orientation</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span>
                <span class="n">local_face_index</span> <span class="o">=</span> \
                    <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">))</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_boundary_face</span><span class="p">(</span><span class="n">face_index</span><span class="p">,</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">get_boundary_markers</span><span class="p">()):</span>
                    <span class="n">boundary_marker</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">find_boundary_marker</span><span class="p">(</span><span class="n">face_index</span><span class="p">,</span>
                                                  <span class="bp">self</span><span class="o">.</span><span class="n">get_boundary_markers</span><span class="p">())</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_boundary_face</span><span class="p">(</span><span class="n">boundary_marker</span><span class="p">,</span>
                                           <span class="n">new_face_index</span><span class="p">,</span>
                                           <span class="n">cell_orientations</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_orientation</span><span class="p">(</span>
                    <span class="n">cell_index</span><span class="p">,</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">cell_orientations</span><span class="p">)</span><span class="o">+</span>
                             <span class="p">[</span><span class="n">cell_orientations</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">]]))</span>

                <span class="n">cell_next_door</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face_to_cell</span><span class="p">(</span><span class="n">face_index</span><span class="p">))</span>
                <span class="n">cell_next_door</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cell_next_door</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">next_door_faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_next_door</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">next_door_local_face_index</span> <span class="o">=</span> \
                        <span class="nb">list</span><span class="p">(</span><span class="n">next_door_faces</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
                    <span class="n">next_door_faces</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">next_door_faces</span><span class="p">)</span><span class="o">+</span><span class="p">[</span><span class="n">new_face_index</span><span class="p">]</span>
                    <span class="n">next_door_orientations</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_normal_orientation</span><span class="p">(</span><span class="n">cell_next_door</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">next_door_orientations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">next_door_orientations</span><span class="p">)</span> <span class="o">+</span> \
                        <span class="p">[</span><span class="n">next_door_orientations</span><span class="p">[</span><span class="n">next_door_local_face_index</span><span class="p">]]</span>
                    <span class="n">next_door_orientations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">next_door_orientations</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_faces</span><span class="p">(</span><span class="n">cell_next_door</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">next_door_faces</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_orientation</span><span class="p">(</span><span class="n">cell_next_door</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="n">next_door_orientations</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">cell_next_door</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">face_segments_to_be_added</span><span class="p">:</span>
                        <span class="n">face_segments_to_be_added</span><span class="p">[</span><span class="n">cell_next_door</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+=</span> \
                                                <span class="p">[</span><span class="n">interior_face_segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">face_segments_to_be_added</span><span class="p">[</span><span class="n">cell_next_door</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span> \
                                                <span class="p">[</span><span class="n">interior_face_segments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>


        <span class="k">if</span> <span class="n">cell_index</span> <span class="ow">in</span> <span class="n">face_segments_to_be_added</span><span class="p">:</span>
            <span class="n">interior_face_segments</span> <span class="o">+=</span> <span class="n">face_segments_to_be_added</span><span class="p">[</span><span class="n">cell_index</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">interior_face_segments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct_polygon_from_segs</span><span class="p">(</span><span class="n">interior_face_segments</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">new_face</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">new_face</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">v2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">new_face</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">new_face</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">new_face_normal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">v1</span><span class="p">)</span>

            <span class="n">new_face_normal</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">new_face_normal</span><span class="p">)</span>

        <span class="n">new_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">new_face</span><span class="p">)</span>

        <span class="p">(</span><span class="n">face_area</span><span class="p">,</span> <span class="n">face_centroid</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_face_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_face_real_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">face_centroid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_face_area</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">face_area</span><span class="p">)</span>

        <span class="n">new_face_normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_face_normal</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_face_normal</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">new_face_normal</span><span class="p">)</span>

        <span class="n">faces_for_cell_1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">faces_for_cell_2</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">normals_for_cell_1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">normals_for_cell_2</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">):</span>
            <span class="n">current_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_real_centroid</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
            <span class="n">plane_to_center</span> <span class="o">=</span> <span class="n">point_on_plane</span> <span class="o">-</span> <span class="n">current_center</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">plane_to_center</span><span class="p">,</span> <span class="n">plane_normal</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">faces_for_cell_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
                <span class="n">local_face_index</span> <span class="o">=</span> \
                    <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">))</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
                <span class="n">face_normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_normal_orientation</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span>
                <span class="n">face_normal</span> <span class="o">=</span> <span class="n">face_normal</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">]</span>
                <span class="n">normals_for_cell_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face_normal</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">faces_for_cell_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
                <span class="n">local_face_index</span> <span class="o">=</span> \
                    <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">cell_index</span><span class="p">))</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">face_index</span><span class="p">)</span>
                <span class="n">face_normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_normal_orientation</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span>
                <span class="n">face_normal</span> <span class="o">=</span> <span class="n">face_normal</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">]</span>
                <span class="n">normals_for_cell_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face_normal</span><span class="p">)</span>

        <span class="n">faces_for_cell_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>
        <span class="n">faces_for_cell_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">new_face_normal</span><span class="p">,</span> <span class="n">plane_normal</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">:</span>
            <span class="n">normals_for_cell_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">normals_for_cell_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">normals_for_cell_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">normals_for_cell_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_faces</span><span class="p">(</span><span class="n">cell_index</span><span class="p">,</span> <span class="n">faces_for_cell_1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_orientation</span><span class="p">(</span><span class="n">cell_index</span><span class="p">,</span> <span class="n">normals_for_cell_1</span><span class="p">)</span>

        <span class="p">(</span><span class="n">cell_volume</span><span class="p">,</span> <span class="n">cell_centroid</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_volume_centroid</span><span class="p">(</span><span class="n">cell_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_real_centroid</span><span class="p">(</span><span class="n">cell_index</span><span class="p">,</span> <span class="n">cell_centroid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_volume</span><span class="p">(</span><span class="n">cell_index</span><span class="p">,</span> <span class="n">cell_volume</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">face_index</span> <span class="ow">in</span> <span class="n">faces_for_cell_2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cell_index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">face_index</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">remove_from_face_to_cell</span><span class="p">(</span><span class="n">face_index</span><span class="p">,</span> <span class="n">cell_index</span><span class="p">)</span>

        <span class="n">new_cell_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="n">faces_for_cell_2</span><span class="p">,</span>
                                       <span class="n">normals_for_cell_2</span><span class="p">)</span>

        <span class="p">(</span><span class="n">cell_volume</span><span class="p">,</span> <span class="n">cell_centroid</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_volume_centroid</span><span class="p">(</span><span class="n">new_cell_index</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_volume</span><span class="p">(</span><span class="n">new_cell_index</span><span class="p">,</span> <span class="n">cell_volume</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_real_centroid</span><span class="p">(</span><span class="n">new_cell_index</span><span class="p">,</span> <span class="n">cell_centroid</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_k</span><span class="p">(</span><span class="n">new_cell_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_k</span><span class="p">(</span><span class="n">cell_index</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">new_cell_index</span>
</div>
<div class="viewcode-block" id="Mesh.build_frac_from_faces"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.build_frac_from_faces">[docs]</a>    <span class="k">def</span> <span class="nf">build_frac_from_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="o">.</span><span class="mo">0001</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Takes a list of face indices, and</span>
<span class="sd">        extrudes them into cells.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">connections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">non_connected_edges</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">faces</span><span class="p">:</span>
            <span class="n">non_connected_edges</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">local_edge_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">face</span><span class="p">))):</span>
                <span class="n">non_connected_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">local_edge_index</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">local_face_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">faces</span><span class="p">)):</span>
            <span class="n">current_face_points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">]))</span>
            <span class="n">current_face_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_face_points</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">local_point_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current_face_points</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">point_1</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">current_face_points</span><span class="p">[</span><span class="n">local_point_index</span><span class="p">])</span>
                <span class="n">point_2</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">current_face_points</span><span class="p">[</span><span class="n">local_point_index</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">local_face_index_2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">local_face_index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                <span class="nb">len</span><span class="p">(</span><span class="n">faces</span><span class="p">)):</span>
                    <span class="n">current_face_points_2</span> <span class="o">=</span> \
                            <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">local_face_index_2</span><span class="p">]))</span>
                    <span class="n">current_face_points_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_face_points_2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                    <span class="k">for</span> <span class="n">local_point_index_2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">current_face_points_2</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="n">point_1_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">current_face_points_2</span><span class="p">[</span><span class="n">local_point_index_2</span><span class="p">])</span>
                        <span class="n">point_2_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">current_face_points_2</span><span class="p">[</span><span class="n">local_point_index_2</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">point_1</span><span class="o">-</span><span class="n">point_1_2</span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">point_2</span><span class="o">-</span><span class="n">point_2_2</span><span class="p">))</span><span class="o">&lt;</span> <span class="mf">1.e-12</span><span class="p">:</span>
                            <span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">local_face_index</span><span class="p">,</span>
                                                <span class="n">local_face_index_2</span><span class="p">,</span>
                                                <span class="n">local_point_index</span><span class="p">,</span>
                                                <span class="n">local_point_index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                <span class="n">local_point_index_2</span><span class="p">,</span>
                                                <span class="n">local_point_index_2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                <span class="mi">1</span><span class="p">])</span>

                            <span class="k">if</span> <span class="n">local_point_index</span> <span class="ow">in</span> <span class="n">non_connected_edges</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">]:</span>
                                <span class="n">non_connected_edges</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_point_index</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">local_point_index_2</span> <span class="ow">in</span> <span class="n">non_connected_edges</span><span class="p">[</span><span class="n">local_face_index_2</span><span class="p">]:</span>
                                <span class="n">non_connected_edges</span><span class="p">[</span><span class="n">local_face_index_2</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_point_index_2</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">point_2</span><span class="o">-</span><span class="n">point_1_2</span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">point_1</span><span class="o">-</span><span class="n">point_2_2</span><span class="p">))</span><span class="o">&lt;</span> <span class="mf">1.e-12</span><span class="p">:</span>
                            <span class="n">connections</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">local_face_index</span><span class="p">,</span>
                                                <span class="n">local_face_index_2</span><span class="p">,</span>
                                                <span class="n">local_point_index</span><span class="p">,</span>
                                                <span class="n">local_point_index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                <span class="n">local_point_index_2</span><span class="p">,</span>
                                                <span class="n">local_point_index_2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                <span class="mi">0</span><span class="p">])</span>

                            <span class="k">if</span> <span class="n">local_point_index</span> <span class="ow">in</span> <span class="n">non_connected_edges</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">]:</span>
                                <span class="n">non_connected_edges</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_point_index</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">local_point_index_2</span> <span class="ow">in</span> <span class="n">non_connected_edges</span><span class="p">[</span><span class="n">local_face_index_2</span><span class="p">]:</span>
                                <span class="n">non_connected_edges</span><span class="p">[</span><span class="n">local_face_index_2</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_point_index_2</span><span class="p">)</span>

        <span class="c">##Find edges that have more than two connections</span>
        <span class="n">multiple_connection_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">multiple_connection_groups</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">connection_index</span><span class="p">,</span> <span class="n">connection</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">connections</span><span class="p">):</span>

            <span class="n">first_face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">point1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">first_face</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
            <span class="n">point2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">first_face</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">first_face</span><span class="p">)])</span>

            <span class="n">multiple_connection_groups</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">remote_connection_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">connection_index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">connections</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">remote_connection_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">multiple_connection_indices</span><span class="p">:</span>
                    <span class="n">remote_connection</span> <span class="o">=</span> <span class="n">connections</span><span class="p">[</span><span class="n">remote_connection_index</span><span class="p">]</span>

                    <span class="n">first_face_remote</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">remote_connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                    <span class="n">point1_remote</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">first_face_remote</span><span class="p">[</span><span class="n">remote_connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                    <span class="n">point2_remote</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">first_face_remote</span><span class="p">[</span><span class="n">remote_connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">first_face_remote</span><span class="p">)])</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">point1</span><span class="o">-</span><span class="n">point1_remote</span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">point2</span><span class="o">-</span><span class="n">point2_remote</span><span class="p">))</span><span class="o">&lt;</span> <span class="mf">1.e-10</span> <span class="ow">or</span>\
                         <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">point2</span><span class="o">-</span><span class="n">point1_remote</span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">point1</span><span class="o">-</span><span class="n">point2_remote</span><span class="p">))</span><span class="o">&lt;</span> <span class="mf">1.e-10</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">multiple_connection_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">multiple_connection_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">connection_index</span><span class="p">)</span>
                            <span class="n">multiple_connection_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remote_connection_index</span><span class="p">)</span>
                            <span class="n">multiple_connection_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">connection_index</span><span class="p">)</span>
                            <span class="n">multiple_connection_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remote_connection_index</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">multiple_connection_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remote_connection_index</span><span class="p">)</span>
                            <span class="n">multiple_connection_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remote_connection_index</span><span class="p">)</span>

        <span class="n">multiple_connection_groups</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">multiple_connection_groups</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">new_multiple_connection_groups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c">## Switch from connection index to actual connections</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">multiple_connection_groups</span><span class="p">:</span>
            <span class="n">new_multiple_connection_groups</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">for</span> <span class="n">connection_index</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                <span class="n">new_multiple_connection_groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">connections</span><span class="p">[</span><span class="n">connection_index</span><span class="p">]))</span>

        <span class="n">multiple_connection_groups</span> <span class="o">=</span> <span class="n">new_multiple_connection_groups</span>
        <span class="n">connections_without_multiple</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">connection_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">connections</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">connection_index</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">multiple_connection_indices</span><span class="p">:</span>
                <span class="n">connections_without_multiple</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">connections</span><span class="p">[</span><span class="n">connection_index</span><span class="p">])</span>

        <span class="n">subface_connections</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c">## For multiple connections, the joining faces must be divided</span>
        <span class="c">## to two, a top and a bottom face.</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">multiple_connection_groups</span><span class="p">:</span>
            <span class="n">done_faces</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="n">group</span><span class="p">:</span>
                <span class="n">current_face</span> <span class="o">=</span> <span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">full_face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">current_face</span><span class="p">])</span>
                <span class="n">point1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">full_face</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                <span class="n">point2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">full_face</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">full_face</span><span class="p">)])</span>
                <span class="n">current_centroid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_real_centroid</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">current_face</span><span class="p">])</span>
                <span class="n">home_vector</span> <span class="o">=</span> <span class="n">current_centroid</span><span class="o">-</span><span class="p">(</span><span class="n">point1</span><span class="o">+</span><span class="n">point2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
                <span class="n">home_vector</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">home_vector</span><span class="p">)</span>
                <span class="n">norm1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">current_face</span><span class="p">])</span>
                <span class="n">max_top_angle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">999</span>
                <span class="n">max_top_connection_index</span> <span class="o">=</span>  <span class="bp">None</span>
                <span class="n">max_bot_angle</span> <span class="o">=</span> <span class="o">-</span><span class="mi">999</span>
                <span class="n">max_bot_connection_index</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">connection_index</span><span class="p">,</span> <span class="n">connection2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">group</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">connection2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_face</span><span class="p">:</span>
                        <span class="n">full_face_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection2</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                        <span class="n">point1_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">full_face_2</span><span class="p">[</span><span class="n">connection2</span><span class="p">[</span><span class="mi">4</span><span class="p">]])</span>
                        <span class="n">point2_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">full_face_2</span><span class="p">[</span><span class="n">connection2</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">full_face_2</span><span class="p">)])</span>
                        <span class="n">centroid_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_real_centroid</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection2</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                        <span class="n">current_vector</span> <span class="o">=</span> <span class="n">centroid_2</span><span class="o">-</span><span class="p">(</span><span class="n">point1_2</span><span class="o">+</span><span class="n">point2_2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
                        <span class="n">current_vector</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">current_vector</span><span class="p">)</span>
                        <span class="n">top_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">home_vector</span><span class="p">,</span> <span class="n">current_vector</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">current_vector</span><span class="p">,</span> <span class="n">norm1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
                            <span class="n">bottom_angle</span> <span class="o">=</span> <span class="o">-</span><span class="n">top_angle</span>
                            <span class="n">top_angle</span> <span class="o">+=</span> <span class="mi">2</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">bottom_angle</span> <span class="o">=</span> <span class="n">top_angle</span><span class="o">+</span><span class="mi">2</span>
                            <span class="n">top_angle</span> <span class="o">=</span> <span class="o">-</span><span class="n">top_angle</span>

                        <span class="k">if</span> <span class="n">top_angle</span> <span class="o">&gt;</span> <span class="n">max_top_angle</span><span class="p">:</span>
                            <span class="n">max_top_angle</span> <span class="o">=</span> <span class="n">top_angle</span>
                            <span class="n">max_top_connection_index</span> <span class="o">=</span> <span class="n">connection_index</span>

                        <span class="k">if</span> <span class="n">bottom_angle</span> <span class="o">&gt;</span> <span class="n">max_bot_angle</span><span class="p">:</span>
                            <span class="n">max_bot_angle</span> <span class="o">=</span> <span class="n">bottom_angle</span>
                            <span class="n">max_bot_connection_index</span> <span class="o">=</span> <span class="n">connection_index</span>

                <span class="n">face2_top</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">max_top_connection_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">face2_bot</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">max_bot_connection_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="p">((</span><span class="n">current_face</span><span class="p">,</span> <span class="s">&#39;TOP&#39;</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">done_faces</span><span class="p">:</span>
                    <span class="n">subface_connections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="n">max_top_connection_index</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="s">&#39;TOP&#39;</span><span class="p">])</span>
                    <span class="n">done_faces</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current_face</span><span class="p">,</span> <span class="s">&#39;TOP&#39;</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">group</span><span class="p">[</span><span class="n">max_top_connection_index</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">done_faces</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">face2_top</span><span class="p">,</span> <span class="s">&#39;TOP&#39;</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">done_faces</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">face2_top</span><span class="p">,</span> <span class="s">&#39;BOT&#39;</span><span class="p">))</span>

                <span class="k">if</span> <span class="p">((</span><span class="n">current_face</span><span class="p">,</span> <span class="s">&#39;BOT&#39;</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">done_faces</span><span class="p">:</span>
                    <span class="n">subface_connections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="n">max_bot_connection_index</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="s">&#39;BOT&#39;</span><span class="p">])</span>
                    <span class="n">done_faces</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current_face</span><span class="p">,</span> <span class="s">&#39;BOT&#39;</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">group</span><span class="p">[</span><span class="n">max_bot_connection_index</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">done_faces</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">face2_bot</span><span class="p">,</span> <span class="s">&#39;BOT&#39;</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">done_faces</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">face2_bot</span><span class="p">,</span> <span class="s">&#39;TOP&#39;</span><span class="p">))</span>

        <span class="n">connections</span> <span class="o">=</span> <span class="n">connections_without_multiple</span>

        <span class="c">## Loop through all the connections, and find out which</span>
        <span class="c">## faces are to contribute to the normal calculation.</span>
        <span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="n">connections</span><span class="p">:</span>
            <span class="c">## The two faces already there</span>
            <span class="n">face_1</span> <span class="o">=</span> <span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">face_2</span> <span class="o">=</span> <span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">faces_for_point_1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([(</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">])])</span>
            <span class="n">faces_for_point_2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([(</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">])])</span>
            <span class="c">## Loop through all the connections, and find overlap</span>
            <span class="c">## between the local point indices.</span>
            <span class="k">for</span> <span class="n">remote_connection</span> <span class="ow">in</span> <span class="n">connections</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">remote_connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">face_1</span> <span class="ow">and</span> \
                        <span class="n">remote_connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">face_2</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">remote_connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">face_1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">remote_connection</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]:</span>
                            <span class="n">faces_for_point_1</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">remote_connection</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                   <span class="n">remote_connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>

                        <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="n">remote_connection</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]:</span>
                            <span class="n">faces_for_point_2</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">remote_connection</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                   <span class="n">remote_connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>

                    <span class="k">if</span> <span class="n">remote_connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">face_1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">remote_connection</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]:</span>
                            <span class="n">faces_for_point_1</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">remote_connection</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                   <span class="n">remote_connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>

                        <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="n">remote_connection</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]:</span>
                            <span class="n">faces_for_point_2</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">remote_connection</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                   <span class="n">remote_connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>

                    <span class="k">if</span> <span class="n">remote_connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">face_2</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="n">remote_connection</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">faces_for_point_1</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">remote_connection</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                       <span class="n">remote_connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">^</span><span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">faces_for_point_2</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">remote_connection</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                       <span class="n">remote_connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">^</span><span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>

                        <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="ow">in</span> <span class="n">remote_connection</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">faces_for_point_2</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">remote_connection</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                       <span class="n">remote_connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">^</span><span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">faces_for_point_1</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">remote_connection</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                       <span class="n">remote_connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">^</span><span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>

                    <span class="k">if</span> <span class="n">remote_connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">face_2</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="n">remote_connection</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">faces_for_point_1</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">remote_connection</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                       <span class="n">remote_connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">^</span><span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">faces_for_point_2</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">remote_connection</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                       <span class="n">remote_connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">^</span><span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>

                        <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="ow">in</span> <span class="n">remote_connection</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">faces_for_point_2</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">remote_connection</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                       <span class="n">remote_connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">^</span><span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">faces_for_point_1</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">remote_connection</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                       <span class="n">remote_connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">^</span><span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>

            <span class="n">connection</span> <span class="o">+=</span> <span class="p">[</span><span class="n">faces_for_point_1</span><span class="p">,</span> <span class="n">faces_for_point_2</span><span class="p">]</span>

        <span class="c">## Loop through all the connections, and find out which</span>
        <span class="c">## faces are to contribute to the normal calculation.</span>
        <span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="n">subface_connections</span><span class="p">:</span>
            <span class="c">## The two faces already there</span>
            <span class="n">face_1</span> <span class="o">=</span> <span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">face_2</span> <span class="o">=</span> <span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">faces_for_point_1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([(</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">])])</span>
            <span class="n">faces_for_point_2</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([(</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span>
                                     <span class="p">(</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">])])</span>

            <span class="n">connection</span> <span class="o">+=</span> <span class="p">[</span><span class="n">faces_for_point_1</span><span class="p">,</span> <span class="n">faces_for_point_2</span><span class="p">]</span>


        <span class="c"># Build the faces.</span>
        <span class="n">new_faces</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c">## Maps the cells to the walls that make them.</span>
        <span class="c">## The cells are identified by the index of the</span>
        <span class="c">## generating face.</span>
        <span class="n">face_to_walls</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">top_points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">bot_points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mid_points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">faces</span><span class="p">)):</span>
            <span class="n">face_to_walls</span><span class="p">[</span><span class="n">face</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">top_points</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">face</span><span class="p">])))</span>
            <span class="n">bot_points</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">face</span><span class="p">])))</span>
            <span class="n">mid_points</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">face</span><span class="p">])))</span>

        <span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="n">connections</span><span class="p">:</span>
            <span class="n">norm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">local_face_index</span><span class="p">,</span> <span class="n">orientation</span><span class="p">)</span> <span class="ow">in</span> <span class="n">connection</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">norm1</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">norm1</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">])</span>

            <span class="n">norm2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">local_face_index</span><span class="p">,</span> <span class="n">orientation</span><span class="p">)</span> <span class="ow">in</span> <span class="n">connection</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">norm2</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">norm2</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">])</span>

            <span class="n">norm1</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">norm1</span><span class="p">)</span>
            <span class="n">norm2</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">norm2</span><span class="p">)</span>

            <span class="n">width1</span> <span class="o">=</span> <span class="n">width</span>
            <span class="n">full_face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="n">point1</span> <span class="o">=</span> <span class="o">-</span><span class="n">width1</span><span class="o">*</span><span class="n">norm1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">full_face</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
            <span class="n">point2</span> <span class="o">=</span> <span class="o">-</span><span class="n">width1</span><span class="o">*</span><span class="n">norm2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">full_face</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">full_face</span><span class="p">)])</span>
            <span class="n">point3</span> <span class="o">=</span> <span class="n">width1</span><span class="o">*</span><span class="n">norm2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">full_face</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">full_face</span><span class="p">)])</span>
            <span class="n">point4</span> <span class="o">=</span> <span class="n">width1</span><span class="o">*</span><span class="n">norm1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">full_face</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

            <span class="n">point_1_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">point1</span><span class="p">)</span>
            <span class="n">point_2_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">point2</span><span class="p">)</span>
            <span class="n">point_3_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">point3</span><span class="p">)</span>
            <span class="n">point_4_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">point4</span><span class="p">)</span>

            <span class="n">new_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_face</span><span class="p">([</span><span class="n">point_1_index</span><span class="p">,</span>
                                            <span class="n">point_2_index</span><span class="p">,</span>
                                            <span class="n">point_3_index</span><span class="p">,</span>
                                            <span class="n">point_4_index</span><span class="p">,])</span>

            <span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">find_face_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>
            <span class="n">current_face_normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_face_normal</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_normal</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">current_face_normal</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_real_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_face_shifted_centroid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_face_shifted_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_area</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>

            <span class="n">face_to_walls</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">new_face_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">face_to_walls</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">new_face_index</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

            <span class="n">top_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">point_4_index</span>
            <span class="n">top_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">%</span>
                                      <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_3_index</span>

            <span class="n">bot_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">=</span><span class="n">point_1_index</span>
            <span class="n">bot_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">%</span>
                                      <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_2_index</span>

            <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">top_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">%</span>
                                      <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_4_index</span>
                <span class="n">top_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">=</span><span class="n">point_3_index</span>

                <span class="n">bot_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">%</span>
                                          <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_1_index</span>
                <span class="n">bot_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">=</span><span class="n">point_2_index</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">bot_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">=</span><span class="n">point_4_index</span>
                <span class="n">bot_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">%</span>
                                      <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_3_index</span>

                <span class="n">top_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">=</span><span class="n">point_1_index</span>
                <span class="n">top_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">%</span>
                                      <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_2_index</span>

            <span class="n">new_faces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>


        <span class="c">## Build the subfaces.</span>
        <span class="k">for</span> <span class="n">connection</span> <span class="ow">in</span> <span class="n">subface_connections</span><span class="p">:</span>
            <span class="n">norm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">local_face_index</span><span class="p">,</span> <span class="n">orientation</span><span class="p">)</span> <span class="ow">in</span> <span class="n">connection</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">norm1</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">norm1</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">])</span>

            <span class="n">norm2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">local_face_index</span><span class="p">,</span> <span class="n">orientation</span><span class="p">)</span> <span class="ow">in</span> <span class="n">connection</span><span class="p">[</span><span class="mi">8</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">norm2</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">norm2</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">])</span>

            <span class="n">norm1</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">norm1</span><span class="p">)</span>
            <span class="n">norm2</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">norm2</span><span class="p">)</span>

            <span class="n">width2</span> <span class="o">=</span> <span class="n">width</span> <span class="o">+</span> <span class="o">.</span><span class="mi">4</span><span class="o">*</span><span class="n">width</span>

            <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;TOP&#39;</span><span class="p">:</span>
                <span class="n">full_face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">point1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">full_face</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                <span class="n">point2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">full_face</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">full_face</span><span class="p">)])</span>
                <span class="n">point3</span> <span class="o">=</span> <span class="n">width2</span><span class="o">*</span><span class="n">norm2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">full_face</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">full_face</span><span class="p">)])</span>
                <span class="n">point4</span> <span class="o">=</span> <span class="n">width2</span><span class="o">*</span><span class="n">norm1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">full_face</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

            <span class="k">elif</span> <span class="n">connection</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;BOT&#39;</span><span class="p">:</span>
                <span class="n">full_face</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="n">point1</span> <span class="o">=</span> <span class="o">-</span><span class="n">width2</span><span class="o">*</span><span class="n">norm1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]])[</span><span class="n">connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
                <span class="n">point2</span> <span class="o">=</span> <span class="o">-</span><span class="n">width2</span><span class="o">*</span><span class="n">norm2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">full_face</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">full_face</span><span class="p">)])</span>
                <span class="n">point3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">full_face</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">full_face</span><span class="p">)])</span>
                <span class="n">point4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="n">full_face</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

            <span class="n">point_1_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">point1</span><span class="p">)</span>
            <span class="n">point_2_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">point2</span><span class="p">)</span>
            <span class="n">point_3_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">point3</span><span class="p">)</span>
            <span class="n">point_4_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">point4</span><span class="p">)</span>

            <span class="n">new_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_face</span><span class="p">([</span><span class="n">point_1_index</span><span class="p">,</span>
                                            <span class="n">point_2_index</span><span class="p">,</span>
                                            <span class="n">point_3_index</span><span class="p">,</span>
                                            <span class="n">point_4_index</span><span class="p">,])</span>

            <span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">find_face_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>
            <span class="n">current_face_normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_face_normal</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_normal</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">current_face_normal</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_real_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_face_shifted_centroid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_face_shifted_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_area</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>

            <span class="n">face_to_walls</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">new_face_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">face_to_walls</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">new_face_index</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;TOP&#39;</span><span class="p">:</span>
                <span class="n">mid_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">=</span><span class="n">point_1_index</span>
                <span class="n">mid_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">%</span>
                                          <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_2_index</span>

                <span class="n">top_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">%</span>
                                          <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_3_index</span>
                <span class="n">top_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">=</span><span class="n">point_4_index</span>


            <span class="k">elif</span> <span class="n">connection</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;BOT&#39;</span><span class="p">:</span>
                <span class="n">bot_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">=</span><span class="n">point_1_index</span>
                <span class="n">bot_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">%</span>
                                          <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_2_index</span>

                <span class="n">mid_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">=</span><span class="n">point_4_index</span>
                <span class="n">mid_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">%</span>
                                          <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_3_index</span>

            <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;TOP&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">top_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">%</span>
                                              <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_4_index</span>
                    <span class="n">top_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">%</span>
                                              <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_3_index</span>

                    <span class="n">mid_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">%</span>
                                              <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_1_index</span>
                    <span class="n">mid_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">%</span>
                                              <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_2_index</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bot_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">=</span><span class="n">point_4_index</span>
                    <span class="n">bot_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">%</span>
                                              <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_3_index</span>

                    <span class="n">mid_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">=</span><span class="n">point_1_index</span>
                    <span class="n">mid_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">%</span>
                                              <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_2_index</span>

            <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;BOT&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">connection</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">mid_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">%</span>
                                              <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_4_index</span>
                    <span class="n">mid_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">=</span><span class="n">point_3_index</span>

                    <span class="n">bot_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">%</span>
                                              <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_1_index</span>
                    <span class="n">bot_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">=</span><span class="n">point_2_index</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mid_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span><span class="o">=</span><span class="n">point_4_index</span>
                    <span class="n">mid_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">%</span>
                                              <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_3_index</span>

                    <span class="n">top_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">%</span>
                                              <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_1_index</span>
                    <span class="n">top_points</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="n">connection</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">%</span>
                                              <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">faces</span><span class="p">[</span><span class="n">connection</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))]</span><span class="o">=</span><span class="n">point_2_index</span>


            <span class="n">new_faces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">local_face_index</span><span class="p">,</span> <span class="n">face</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">non_connected_edges</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">point1</span> <span class="ow">in</span> <span class="n">face</span><span class="p">:</span>
                <span class="n">global_face_index</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">]</span>
                <span class="n">point2</span> <span class="o">=</span> <span class="p">(</span><span class="n">point1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">global_face_index</span><span class="p">))</span>

                <span class="n">new_face_points</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">global_face_index</span><span class="p">)</span>
                <span class="n">width1</span> <span class="o">=</span> <span class="n">width</span>
                <span class="k">if</span> <span class="n">bot_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">][</span><span class="n">point1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">new_point</span> <span class="o">=</span> <span class="o">-</span><span class="n">width1</span><span class="o">*</span><span class="n">norm</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">global_face_index</span><span class="p">)[</span><span class="n">point1</span><span class="p">])</span>
                    <span class="n">point_1_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">new_point</span><span class="p">)</span>
                    <span class="n">bot_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">][</span><span class="n">point1</span><span class="p">]</span> <span class="o">=</span> <span class="n">point_1_index</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">point_1_index</span> <span class="o">=</span> <span class="n">bot_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">][</span><span class="n">point1</span><span class="p">]</span>

                <span class="n">new_face_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point_1_index</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">bot_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">][</span><span class="n">point2</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">new_point</span> <span class="o">=</span> <span class="o">-</span><span class="n">width1</span><span class="o">*</span><span class="n">norm</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">global_face_index</span><span class="p">)[</span><span class="n">point2</span><span class="p">])</span>
                    <span class="n">point_2_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">new_point</span><span class="p">)</span>
                    <span class="n">bot_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">][</span><span class="n">point2</span><span class="p">]</span> <span class="o">=</span> <span class="n">point_2_index</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">point_2_index</span> <span class="o">=</span> <span class="n">bot_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">][</span><span class="n">point2</span><span class="p">]</span>

                <span class="n">new_face_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point_2_index</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">mid_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">][</span><span class="n">point2</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">new_face_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mid_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">][</span><span class="n">point2</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">top_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">][</span><span class="n">point2</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">new_point</span> <span class="o">=</span> <span class="n">width1</span><span class="o">*</span><span class="n">norm</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">global_face_index</span><span class="p">)[</span><span class="n">point2</span><span class="p">])</span>
                    <span class="n">point_3_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">new_point</span><span class="p">)</span>
                    <span class="n">top_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">][</span><span class="n">point2</span><span class="p">]</span> <span class="o">=</span> <span class="n">point_3_index</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">point_3_index</span> <span class="o">=</span> <span class="n">top_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">][</span><span class="n">point2</span><span class="p">]</span>

                <span class="n">new_face_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point_3_index</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">top_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">][</span><span class="n">point1</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">new_point</span> <span class="o">=</span> <span class="n">width1</span><span class="o">*</span><span class="n">norm</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">get_point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">global_face_index</span><span class="p">)[</span><span class="n">point1</span><span class="p">])</span>
                    <span class="n">point_4_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_point</span><span class="p">(</span><span class="n">new_point</span><span class="p">)</span>
                    <span class="n">top_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">][</span><span class="n">point1</span><span class="p">]</span> <span class="o">=</span> <span class="n">point_4_index</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">point_4_index</span> <span class="o">=</span> <span class="n">top_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">][</span><span class="n">point1</span><span class="p">]</span>

                <span class="n">new_face_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point_4_index</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">mid_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">][</span><span class="n">point1</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">new_face_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mid_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">][</span><span class="n">point1</span><span class="p">])</span>

                <span class="n">new_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">new_face_points</span><span class="p">)</span>
                <span class="n">current_face_normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_face_normal</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_face_normal</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">current_face_normal</span><span class="p">)</span>

                <span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">find_face_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_face_real_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_face_shifted_centroid</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_face_shifted_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">set_face_area</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">current_face_normal</span><span class="p">,</span> <span class="n">centroid</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face_real_centroid</span><span class="p">(</span><span class="n">global_face_index</span><span class="p">))</span><span class="o">&gt;</span>  <span class="mf">0.</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_internal_no_flow</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_internal_no_flow</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

                <span class="n">face_to_walls</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">new_face_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

                <span class="n">new_faces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>


        <span class="c">## Adds the top and bottom faces.</span>
        <span class="k">for</span> <span class="n">local_face_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">faces</span><span class="p">)):</span>
            <span class="n">new_face_points</span> <span class="o">=</span> <span class="n">top_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">]</span>
            <span class="n">new_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">new_face_points</span><span class="p">)</span>
            <span class="n">face_to_walls</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">new_face_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_internal_no_flow</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">find_face_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>
            <span class="n">current_face_normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_face_normal</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_normal</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">current_face_normal</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_real_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_face_shifted_centroid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_face_shifted_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_area</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>

            <span class="n">new_faces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>

            <span class="n">new_face_points</span> <span class="o">=</span> <span class="n">bot_points</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">]</span>
            <span class="n">new_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">new_face_points</span><span class="p">)</span>
            <span class="n">face_to_walls</span><span class="p">[</span><span class="n">local_face_index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">new_face_index</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_internal_no_flow</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">find_face_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>
            <span class="n">current_face_normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_face_normal</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_normal</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">current_face_normal</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_real_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_face_shifted_centroid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_face_shifted_centroid</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_face_area</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>

            <span class="n">new_faces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_face_index</span><span class="p">)</span>

        <span class="c"># Duplicate reservoir face for interior dirichlet boundary.</span>
        <span class="k">for</span> <span class="n">face</span> <span class="ow">in</span> <span class="n">face_to_walls</span><span class="p">:</span>
            <span class="n">top_res_face_index</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">face</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">top_res_face_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">top_res_face_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">:</span>
                <span class="n">bot_res_face_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_face</span><span class="p">(</span><span class="n">top_res_face_index</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_face_area</span><span class="p">(</span><span class="n">bot_res_face_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_area</span><span class="p">(</span><span class="n">top_res_face_index</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_face_normal</span><span class="p">(</span><span class="n">bot_res_face_index</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_face_normal</span><span class="p">(</span><span class="n">top_res_face_index</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_face_real_centroid</span><span class="p">(</span><span class="n">bot_res_face_index</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">get_face_real_centroid</span><span class="p">(</span><span class="n">top_res_face_index</span><span class="p">))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_face_shifted_centroid</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_face_shifted_centroid</span><span class="p">(</span><span class="n">bot_res_face_index</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">get_face_real_centroid</span><span class="p">(</span><span class="n">top_res_face_index</span><span class="p">))</span>

                <span class="n">bottom_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">top_res_face_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

                <span class="n">new_cell_faces</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">bottom_cell</span><span class="p">))</span>
                <span class="n">local_face_index_in_cell</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_cell_faces</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">top_res_face_index</span><span class="p">)</span>

                <span class="n">new_cell_faces</span><span class="p">[</span><span class="n">local_face_index_in_cell</span><span class="p">]</span> <span class="o">=</span> <span class="n">bot_res_face_index</span>

                <span class="n">top_cell_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">face_to_cell</span><span class="p">[</span><span class="n">top_res_face_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">local_top_face_index_in_cell</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_cell</span><span class="p">(</span><span class="n">top_cell_index</span><span class="p">))</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">top_res_face_index</span><span class="p">)</span>
                <span class="n">top_res_face_orientation</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_cell_normal_orientation</span><span class="p">(</span><span class="n">top_cell_index</span><span class="p">)[</span><span class="n">local_top_face_index_in_cell</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">remove_from_face_to_cell</span><span class="p">(</span><span class="n">top_res_face_index</span><span class="p">,</span> <span class="n">bottom_cell</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_faces</span><span class="p">(</span><span class="n">bottom_cell</span><span class="p">,</span> <span class="n">new_cell_faces</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Face on boundary encountered&quot;</span><span class="p">)</span>

            <span class="n">new_cell_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">face_to_walls</span><span class="p">[</span><span class="n">face</span><span class="p">]]),</span>
                                           <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="s">&#39;i&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">face_to_walls</span><span class="p">[</span><span class="n">face</span><span class="p">]]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_domain</span><span class="p">(</span><span class="n">new_cell_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_volume_centroid</span><span class="p">(</span><span class="n">new_cell_index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_volume</span><span class="p">(</span><span class="n">new_cell_index</span><span class="p">,</span> <span class="n">volume</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_real_centroid</span><span class="p">(</span><span class="n">new_cell_index</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_cell_shifted_centroid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_shifted_centroid</span><span class="p">(</span><span class="n">new_cell_index</span><span class="p">,</span> <span class="n">centroid</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_cell_k</span><span class="p">(</span><span class="n">new_cell_index</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">1.</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_forcing_pointer</span><span class="p">(</span><span class="n">new_cell_index</span><span class="p">,</span>
                                     <span class="p">[</span><span class="n">top_res_face_index</span><span class="p">,</span> <span class="n">bot_res_face_index</span><span class="p">],</span>
                                     <span class="p">[</span><span class="n">top_res_face_orientation</span><span class="p">,</span> <span class="o">-</span><span class="n">top_res_face_orientation</span><span class="p">])</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">set_dirichlet_face_pointer</span><span class="p">(</span><span class="n">top_res_face_index</span><span class="p">,</span>
                                            <span class="n">top_res_face_orientation</span><span class="p">,</span>
                                            <span class="n">new_cell_index</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_dirichlet_face_pointer</span><span class="p">(</span><span class="n">bot_res_face_index</span><span class="p">,</span>
                                            <span class="o">-</span><span class="n">top_res_face_orientation</span><span class="p">,</span>
                                            <span class="n">new_cell_index</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_vtk_faces</span><span class="p">(</span><span class="s">&quot;new_faces&quot;</span><span class="p">,</span> <span class="n">new_faces</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Mesh.build_mesh"><a class="viewcode-back" href="../../../meshclass.html#mimpy.mesh.mesh.Mesh.build_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">build_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Base class function for constructing the mesh.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div></div>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Omar Al-Hinai.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>